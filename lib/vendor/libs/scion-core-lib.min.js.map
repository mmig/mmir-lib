{"version":3,"sources":["webpack://scionCoreLib/webpack/universalModuleDefinition","webpack://scionCoreLib/webpack/bootstrap","webpack://scionCoreLib/./node_modules/process/browser.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/constants.js","webpack://scionCoreLib/./node_modules/timers-browserify/main.js","webpack://scionCoreLib/(webpack)/buildin/global.js","webpack://scionCoreLib/./index.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core/lib/Statechart.js","webpack://scionCoreLib/./node_modules/setimmediate/setImmediate.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/scion-core-base.js","webpack://scionCoreLib/./node_modules/tiny-events/lib/index.js","webpack://scionCoreLib/./node_modules/util/util.js","webpack://scionCoreLib/./node_modules/util/support/isBufferBrowser.js","webpack://scionCoreLib/./node_modules/util/node_modules/inherits/inherits_browser.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/ArraySet.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/helpers.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/query.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","setTimeout","e","this","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","length","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","args","Array","arguments","push","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","STATE_TYPES","BASIC","COMPOSITE","PARALLEL","HISTORY","INITIAL","FINAL","SCXML_IOPROCESSOR_TYPE","HTTP_IOPROCESSOR_TYPE","RX_TRAILING_WILDCARD","scope","global","self","Function","Timeout","id","clearFn","_id","_clearFn","setInterval","clearInterval","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","require","setImmediate","clearImmediate","g","base","query","helpers","transitionComparator","Statechart","modelOrModelFactory","opts","legacySemantics","currentEvent","selectEventlessTransitions","transitionSelector","enabledTransitions","Set","_evaluateAction","_configuration","iter","sort","state","getAncestors","loop","transitions","add","priorityEnabledTransitions","_removeConflictingTransition","_log","filteredTransitions","t1","t1Preempted","transitionsToRemove","t2","t1ExitSet","_computeExitSet","t2ExitSet","hasIntersection","some","has","source","map","descendants","indexOf","t3","remove","BaseInterpreter","InterpreterScriptingContext","invokers","invokingSession","invokeObj","invokerExecutionContext","cb","constructorFunction","interpreter","fnModel","options","invokeid","params","parentSession","docUrl","model","start","undefined","registerImmediate","html","channel","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","document","attachTo","getPrototypeOf","toString","handle","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","event","data","port2","createElement","documentElement","script","onreadystatechange","removeChild","appendChild","Math","random","slice","addEventListener","attachEvent","callback","task","EventEmitter","util","ArraySet","constants","extend","transitionWithTargets","initializeModel","scxmlPrefixTransitionSelector","isEventPrefixMatch","isTransitionMatch","getTransitionWithHigherSourceChildPriority","eventlessTransitionSelector","sortInEntryOrder","getStateWithHigherSourceChildPriority","initializeModelGeneratorFn","deserializeSerializedConfiguration","deserializeHistory","printTrace","DEBUG","_isStepping","_scriptingContext","interpreterScriptingContext","generateSessionid","sessionid","sessionRegistry","_executionContext","_ioprocessors","location","scxml","_x","_sessionid","JSON","parse","stringify","_model","console","log","priorityComparisonFn","set","String","join","_externalEventQueue","_internalEventQueue","$deserializeDatamodel","snapshot","$idToStateMap","_historyValue","_isInFinalState","EVENTS","forEach","_exitInterpreter","_cancelAllDelayedSends","statesToExit","_getFullConfiguration","j","stateExited","onExit","exitIdx","exitLen","block","blockIdx","blockLen","actionRef","_handleError","invokes","invoke","cancelInvoke","$type","parent","send","target","donedata","_initStart","_performBigStep","getConfiguration","genAsync","nop","initialRef","reduce","a","b","stateName","getFullConfiguration","keepGoing","allStatesExited","allStatesEntered","_startBigStep","_selectTransitionsAndPerformSmallStep","_finishBigStep","selectedTransitions","_selectTransitions","isEmpty","ev","shift","statesExited","statesEntered","_performSmallStep","autoforward","finalize","action","from","filter","f","every","typeEnum","_timeouts","timeoutOptions","sendOptions","delay","timeoutHandle","keys","_timeoutMap","nextStep","selectedTransitionsWithTargets","_exitStates","_executeTransitions","_enterStates","_getStatesExited","isAtomic","historyRef","isDeep","s0","basicStatesExited","transitionList","txIdx","txLen","desc","configList","cfgIdx","cfgLen","ancestors","ancIdx","ancLen","sortedTransitions","stxIdx","transition","targetIds","targets","onTransition","statesForDefaultEntry","defaultHistoryContent","_computeEntrySet","enterIdx","enterLen","stateEntered","onEntry","entryIdx","entryLen","initialState","grandparent","states","isInFinalState","_getEffectiveTargetStates","statesToEnter","_addDescendantStatesToEnter","ancestor","_addAncestorStatesToEnter","isDescendant","traverse","anc","child","targetState","contains","__proto__","match","tagname","line","column","reason","message","type","arg","inspect","listener","events","getEvents","stateIdx","stateLen","_serializeHistory","$serializeDatamodel","sid","evtObjOrName","optionalData","_performBigStepAsync","err","config","sessionIdCounter","Map","_interpreter","_invokeMap","validateUriRegex","invokeSendTargetRegex","scxmlSendTargetRegex","_installDefaultPropsOnEvent","xmlString","xmlParser","Promise","resolve","reject","session","sessionPromise","then","cancel","isInternal","origin","origintype","prop","sendFn","sendType","customSend","raise","sendid","doSend","targetSessionId","invokeId","sendAsync","sendAction","test","customCancel","_listeners","isArray","__once","index","splice","getOwnPropertyDescriptors","obj","descriptors","getOwnPropertyDescriptor","formatRegExp","format","isString","objects","str","replace","x","Number","_","isNull","isObject","deprecate","fn","msg","noDeprecation","warned","throwDeprecation","traceDeprecation","trace","error","debugEnviron","debugs","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","isUndefined","customInspect","stylizeWithColor","formatValue","styleType","style","styles","recurseTimes","isFunction","constructor","ret","primitive","simple","isNumber","formatPrimitive","visibleKeys","hash","val","idx","arrayToHash","getOwnPropertyNames","isError","formatError","isRegExp","RegExp","isDate","Date","output","braces","toUTCString","formatProperty","formatArray","pop","prev","cur","numLinesEst","reduceToSingleString","split","substr","ar","re","objectToString","pad","debuglog","NODE_DEBUG","toUpperCase","pid","isNullOrUndefined","isSymbol","isPrimitive","isBuffer","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth","inherits","kCustomPromisifiedSymbol","callbackifyOnRejected","newReason","promisify","original","TypeError","writable","configurable","promiseResolve","promiseReject","promise","setPrototypeOf","defineProperties","custom","callbackify","callbackified","maybeCb","rej","copy","fill","readUInt8","ctor","superCtor","super_","TempCtor","union","v","difference","size","equals","s2","prefix","fullName","charAt","eventName","tEvent","s1","documentOrder","to","k","rootState","idToStateMap","idCount","statesWithInitialAttributes","checkInitialRef","RX_WHITESPACE","getScope","transitionIsReallyInternal","lcca","getLCCA","commonAncestors","populateStateIdMap","fakeRootState","ancs","initialChildren","initial","historyChildren","count","generateId","handler","trim","connectTransitionGraph","initialStates","connectIntialAttributes","evaluator","cond","_args","modelFn","isIn","serializedConfiguration","serializedHistory","isOrthogonalTo","isAncestrallyRelatedTo","getLCA","getAncestorsOrSelf","getDescendantsOrSelf"],"mappings":"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","file":"scion-core-lib.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"scionCoreLib\"] = factory();\n\telse\n\t\troot[\"scionCoreLib\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var STATE_TYPES = {\n    BASIC: 0,\n    COMPOSITE: 1,\n    PARALLEL: 2,\n    HISTORY: 3,\n    INITIAL: 4,\n    FINAL: 5\n};\n\nconst SCXML_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#SCXMLEventProcessor'\nconst HTTP_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor'\nconst RX_TRAILING_WILDCARD = /\\.\\*$/;\n\nmodule.exports = {\n  STATE_TYPES : STATE_TYPES,\n  SCXML_IOPROCESSOR_TYPE  : SCXML_IOPROCESSOR_TYPE,\n  HTTP_IOPROCESSOR_TYPE  : HTTP_IOPROCESSOR_TYPE, \n  RX_TRAILING_WILDCARD  : RX_TRAILING_WILDCARD \n};\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\nmodule.exports = require('@scion-scxml/core');\n","const base = require('@scion-scxml/core-base'),\n      helpers = base.helpers,\n      query = base.query,\n      transitionComparator = base.helpers.transitionComparator;\n\n/** \n * @description Implements semantics described in Algorithm D of the SCXML specification. \n * See {@link scion.BaseInterpreter} for information on the constructor arguments.\n * @class SCInterpreter \n * @extends BaseInterpreter\n */\nclass Statechart extends base.BaseInterpreter {\n\n  constructor(modelOrModelFactory, opts){\n\n    opts = opts || {};\n    opts.legacySemantics = false;\n\n    super(modelOrModelFactory, opts);\n  }\n\n  /** @private */\n  _selectTransitions(currentEvent, selectEventlessTransitions) {\n    var transitionSelector = this.opts.transitionSelector;\n    var enabledTransitions = new this.opts.Set();\n\n    var e = this._evaluateAction.bind(this,currentEvent);\n\n    let atomicStates = this._configuration.iter().sort(transitionComparator);\n    for(let state of atomicStates){\nloop: for(let s of [state].concat(query.getAncestors(state))){\n        for(let t of s.transitions){\n          if(transitionSelector(t, currentEvent, e, selectEventlessTransitions)){\n            enabledTransitions.add(t);\n            break loop;\n          }\n        }\n      }\n    }\n\n    var priorityEnabledTransitions = this._removeConflictingTransition(enabledTransitions);\n\n    this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n\n    return priorityEnabledTransitions;\n  }\n\n  /** @private */\n  _removeConflictingTransition(enabledTransitions) {\n    let filteredTransitions = new this.opts.Set()\n    //toList sorts the transitions in the order of the states that selected them\n    for( let t1 of enabledTransitions.iter()){\n      let t1Preempted = false;\n      let transitionsToRemove = new Set()\n      for (let t2 of filteredTransitions.iter()){\n        //TODO: can we compute this statically? for example, by checking if the transition scopes are arena orthogonal?\n        let t1ExitSet = this._computeExitSet([t1]);\n        let t2ExitSet = this._computeExitSet([t2]);\n        let hasIntersection = [...t1ExitSet].some( s => t2ExitSet.has(s) )  || [...t2ExitSet].some( s => t1ExitSet.has(s));\n        this._log('t1ExitSet',t1.source.id,[...t1ExitSet].map( s => s.id ))\n          this._log('t2ExitSet',t2.source.id,[...t2ExitSet].map( s => s.id ))\n          this._log('hasIntersection',hasIntersection)\n          if(hasIntersection){\n            if(t2.source.descendants.indexOf(t1.source) > -1){    //is this the same as being ancestrally related?\n              transitionsToRemove.add(t2)\n            }else{ \n              t1Preempted = true;\n              break\n            }\n          }\n      }\n      if(!t1Preempted){\n        for(let t3 of transitionsToRemove){\n          filteredTransitions.remove(t3)\n        }\n        filteredTransitions.add(t1)\n      }\n    }\n\n    return filteredTransitions;\n  }\n}\n\nbase.Statechart = Statechart;\n//simple default invoker\nbase.InterpreterScriptingContext.invokers = {\n  \"http://www.w3.org/TR/scxml/\" : function(invokingSession, invokeObj, invokerExecutionContext, cb){\n    //put invoke logic here: \n    let method, arg;\n    if(invokeObj.constructorFunction){\n      const fnModel = invokeObj.constructorFunction;\n      const options = {\n        invokeid : invokeObj.id,\n        params : invokeObj.params,\n        parentSession : invokingSession,\n        docUrl : invokeObj.docUrl\n        //sessionid : //TODO: construct or generate a sessionid for invoked session\n      };\n      const model = invokerExecutionContext;\n      let interpreter;\n      if( options.parentSession instanceof Statechart ){\n        interpreter = new Statechart(fnModel, options);\n      } \n      cb(null, interpreter, fnModel, model);\n      //we introduce a delay here before starting the interpreter to give clients that are subscribed to onInvokedSessionInitialized event a chance to subscribe to events on the newly instantiated interpreter\n      setImmediate( () => interpreter.start() );    \n    } else{\n      throw new Error('Invoke object needs a constructorFunction property' );\n    }\n  }\n};\nbase.InterpreterScriptingContext.invokers[undefined] = \n  base.InterpreterScriptingContext.invokers[null] = \n  base.InterpreterScriptingContext.invokers['scxml'] = \n  base.InterpreterScriptingContext.invokers[\"http://www.w3.org/TR/scxml/\"];\n\nmodule.exports = base;\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","//   Copyright 2012-2012 Jacob Beard, INFICON, and other SCION contributors\n//\n//   Licensed under the Apache License, Version 2.0 (the \"License\");\n//   you may not use this file except in compliance with the License.\n//   You may obtain a copy of the License at\n//\n//       http://www.apache.org/licenses/LICENSE-2.0\n//\n//   Unless required by applicable law or agreed to in writing, software\n//   distributed under the License is distributed on an \"AS IS\" BASIS,\n//   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n//   See the License for the specific language governing permissions and\n//   limitations under the License.\n\n/**\n * SCION-CORE global object\n * @namespace scion\n */\n\n/**\n * An Array of strings representing the ids all of the basic states the\n * interpreter is in after a big-step completes.\n * @typedef {Array<string>} Configuration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n\"use strict\";\n\nconst EventEmitter = require('tiny-events').EventEmitter,\n  util = require('util'),\n  ArraySet = require('./ArraySet'),\n  constants = require('./constants'),\n  helpers = require('./helpers'),\n  query = require('./query'),\n  extend = helpers.extend,\n  transitionWithTargets = helpers.transitionWithTargets,\n  transitionComparator = helpers.transitionComparator,\n  initializeModel = helpers.initializeModel,\n  isEventPrefixMatch = helpers.isEventPrefixMatch,\n  isTransitionMatch = helpers.isTransitionMatch,\n  scxmlPrefixTransitionSelector = helpers.scxmlPrefixTransitionSelector,\n  eventlessTransitionSelector = helpers.eventlessTransitionSelector,\n  getTransitionWithHigherSourceChildPriority = helpers.getTransitionWithHigherSourceChildPriority,\n  sortInEntryOrder = helpers.sortInEntryOrder,\n  getStateWithHigherSourceChildPriority = helpers.getStateWithHigherSourceChildPriority,\n  initializeModelGeneratorFn = helpers.initializeModelGeneratorFn,\n  deserializeSerializedConfiguration = helpers.deserializeSerializedConfiguration,\n  deserializeHistory = helpers.deserializeHistory,\n  BASIC = constants.STATE_TYPES.BASIC,\n  COMPOSITE = constants.STATE_TYPES.COMPOSITE,\n  PARALLEL = constants.STATE_TYPES.PARALLEL,\n  HISTORY = constants.STATE_TYPES.HISTORY,\n  INITIAL = constants.STATE_TYPES.INITIAL,\n  FINAL = constants.STATE_TYPES.FINAL,\n  SCXML_IOPROCESSOR_TYPE  = constants.SCXML_IOPROCESSOR_TYPE;\n\nconst printTrace = typeof process !== 'undefined' && !!process.env.DEBUG;\n\n\n/**\n * @interface EventEmitter\n */\n\n/**\n* @event scion.BaseInterpreter#onError\n* @property {string} tagname The name of the element that produced the error. \n* @property {number} line The line in the source file in which the error occurred.\n* @property {number} column The column in the source file in which the error occurred.\n* @property {string} reason An informative error message. The text is platform-specific and subject to change.\n*/\n\n\n/**\n * @function\n * @name EventEmitter.prototype#on\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#once\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#off\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#emit\n * @param {string} type\n * @param {any} args\n */\n/** \n * @description The SCXML constructor creates an interpreter instance from a model object.\n * @abstract\n * @class BaseInterpreter\n * @memberof scion\n * @extends EventEmitter\n * @param {SCJSON | scxml.ModelFactory} modelOrModelFactory Either an SCJSON root state; or an scxml.ModelFactory, which is a function which returns an SCJSON object. \n * @param opts\n * @param {string} [opts.sessionid] Used to populate SCXML _sessionid.\n * @param {function} [opts.generateSessionid] Factory used to generate sessionid if sessionid keyword is not specified\n * @param {Map<string, BaseInterpreter>} [opts.sessionRegistry] Map used to map sessionid strings to Statechart instances.\n * @param [opts.Set] Class to use as an ArraySet. Defaults to ES6 Set.\n * @param {object} [opts.params]  Used to pass params from invoke. Sets the datamodel when interpreter is instantiated.\n * @param {Snapshot} [opts.snapshot] State machine snapshot. Used to restore a serialized state machine.\n * @param {Statechart} [opts.parentSession]  Used to pass parent session during invoke.\n * @param {string }[opts.invokeid]  Support for id of invoke element at runtime.\n * @param {boolean} [opts.legacySemantics]\n * @param [opts.console]\n * @param [opts.transitionSelector]\n * @param [opts.customCancel]\n * @param [opts.customSend]\n * @param [opts.sendAsync]\n * @param [opts.doSend]\n * @param [opts.invokers]\n * @param [opts.xmlParser]\n * @param [opts.interpreterScriptingContext]\n * @param [opts.invokerExecutionContext]\n */\nclass BaseInterpreter extends EventEmitter {\n\n  constructor(modelOrModelFactory, opts){\n\n    super();\n\n    this.opts = opts;\n\n    this.opts.InterpreterScriptingContext = this.opts.InterpreterScriptingContext || InterpreterScriptingContext;\n\n    this._isStepping = false;\n\n    this._scriptingContext = this.opts.interpreterScriptingContext || (this.opts.InterpreterScriptingContext ? new this.opts.InterpreterScriptingContext(this) : {}); \n\n    this.opts.generateSessionid = this.opts.generateSessionid || BaseInterpreter.generateSessionid;\n    this.opts.sessionid = this.opts.sessionid || this.opts.generateSessionid();\n    this.opts.sessionRegistry = this.opts.sessionRegistry || BaseInterpreter.sessionRegistry;  //TODO: define a better interface. For now, assume a Map<sessionid, session>\n    this.opts.invokerExecutionContext = opts.invokerExecutionContext ||  modelOrModelFactory._executionContext;\n\n\n    let _ioprocessors = {};\n    _ioprocessors[SCXML_IOPROCESSOR_TYPE] = {\n      location : `#_scxml_${this.opts.sessionid}`\n    }\n    _ioprocessors.scxml = _ioprocessors[SCXML_IOPROCESSOR_TYPE];    //alias\n\n    //SCXML system variables:\n    this.opts._x = {\n        _sessionid : this.opts.sessionid,\n        _ioprocessors : _ioprocessors\n    };\n\n\n    var model;\n    if(typeof modelOrModelFactory === 'function'){\n        model = initializeModelGeneratorFn(modelOrModelFactory, this.opts, this);\n    }else if(typeof modelOrModelFactory === 'object'){\n        model = JSON.parse(JSON.stringify(modelOrModelFactory)); //assume object\n    }else{\n        throw new Error('Unexpected model type. Expected model factory function, or scjson object.');\n    }\n\n    this._model = initializeModel(model, this.opts);\n\n    this.opts.console = this.opts.console || (typeof console === 'undefined' ? {log : function(){}} : console);   //rely on global console if this console is undefined\n    this.opts.Set = this.opts.Set || ArraySet;\n    this.opts.priorityComparisonFn = this.opts.priorityComparisonFn || getTransitionWithHigherSourceChildPriority;\n    this.opts.transitionSelector = this.opts.transitionSelector || scxmlPrefixTransitionSelector;\n\n    this.opts.sessionRegistry.set(String(this.opts.sessionid), this);\n\n    this._scriptingContext.log = this._scriptingContext.log || (function log(){ \n      if(this.opts.console.log.apply){\n        this.opts.console.log.apply(this.opts.console, arguments); \n      } else {\n        //console.log on older IE does not support Function.apply, so just pass him the first argument. Best we can do for now.\n        this.opts.console.log(Array.prototype.slice.apply(arguments).join(',')); \n      }\n    }.bind(this));   //set up default scripting context log function\n\n    this._externalEventQueue = [];\n    this._internalEventQueue = [];\n\n    if(this.opts.params){\n      this._model.$deserializeDatamodel(this.opts.params);   //load up the datamodel\n    }\n\n    //check if we're loading from a previous snapshot\n    if(this.opts.snapshot){\n      this._configuration = new this.opts.Set(deserializeSerializedConfiguration(this.opts.snapshot[0], this._model.$idToStateMap));\n      this._historyValue = deserializeHistory(this.opts.snapshot[1], this._model.$idToStateMap); \n      this._isInFinalState = this.opts.snapshot[2];\n      this._model.$deserializeDatamodel(this.opts.snapshot[3]);   //load up the datamodel\n      this._internalEventQueue = this.opts.snapshot[4];\n    }else{\n      this._configuration = new this.opts.Set();\n      this._historyValue = {};\n      this._isInFinalState = false;\n    }\n\n    //add debug logging\n    BaseInterpreter.EVENTS.forEach(function(event){\n      this.on(event, this._log.bind(this,event));\n    }, this);\n\n    module.exports.emit('new',this);\n  }\n\n  /** \n  * Cancels the session. This clears all timers; puts the interpreter in a\n  * final state; and runs all exit actions on current states.\n  * @memberof BaseInterpreter.prototype\n  */\n  cancel(){\n    delete this.opts.parentSession;\n    if(this._isInFinalState) return;\n    this._isInFinalState = true;\n    this._log(`session cancelled ${this.opts.invokeid}`);\n    this._exitInterpreter(null);\n  }\n\n  _exitInterpreter(event){\n    //TODO: cancel invoked sessions\n    //cancel all delayed sends when we enter into a final state.\n    this._cancelAllDelayedSends();\n\n    let statesToExit = this._getFullConfiguration().sort(getStateWithHigherSourceChildPriority);\n\n    for (var j = 0, len = statesToExit.length; j < len; j++) {\n        var stateExited = statesToExit[j];\n\n        if(stateExited.onExit !== undefined) {\n            for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n                let block = stateExited.onExit[exitIdx];\n                for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                    let actionRef = block[blockIdx];\n                    try {\n                      actionRef.call(this._scriptingContext, null);\n                    } catch (e){\n                      this._handleError(e, actionRef);\n                      break;\n                    }\n                }\n            }\n        }\n\n        //cancel invoked session\n        if(stateExited.invokes) stateExited.invokes.forEach( invoke => {\n          this._scriptingContext.cancelInvoke(invoke.id);\n        })\n\n        //if he is a top-level <final> state, then return the done event\n        if( stateExited.$type === 'final' &&\n            stateExited.parent.$type === 'scxml'){\n\n          if(this.opts.parentSession){\n            this._scriptingContext.send({\n              target: '#_parent', \n              name: 'done.invoke.' + this.opts.invokeid,\n              data : stateExited.donedata && stateExited.donedata.call(this._scriptingContext, event)\n            });\n          }\n\n          this.opts.sessionRegistry.delete(this.opts.sessionid);\n          this.emit('onExitInterpreter', event);\n        }\n    }\n\n  }\n\n  /** \n   * Starts the interpreter. Should only be called once, and should be called\n   * before BaseInterpreter.prototype#gen is called for the first time.  Returns a\n   * Configuration.\n   * @return {Configuration}\n   * @memberof BaseInterpreter.prototype\n   * @emits scion.BaseInterpreter#onEntry\n   * @emits scion.BaseInterpreter#onExit\n   * @emits scion.BaseInterpreter#onTransition\n   * @emits scion.BaseInterpreter#onDefaultEntry\n   * @emits scion.BaseInterpreter#onError\n   * @emits scion.BaseInterpreter#onBigStepBegin\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onBigStepSuspend\n   * @emits scion.BaseInterpreter#onBigStepResume\n   * @emits scion.BaseInterpreter#onSmallStepBegin\n   * @emits scion.BaseInterpreter#onSmallStepEnd\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onExitInterpreter\n   */\n  start() {\n      this._initStart();\n      this._performBigStep();\n      return this.getConfiguration();\n  }\n\n\n  /**\n   * This callback is displayed as a global member.\n   * @callback genCallback\n   * @param {Error} err\n   * @param {Configuration} configuration\n   */\n\n  /**\n   * Starts the interpreter asynchronously\n   * @param  {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n   * @memberof BaseInterpreter.prototype \n   * @emits scion.BaseInterpreter#onEntry\n   * @emits scion.BaseInterpreter#onExit\n   * @emits scion.BaseInterpreter#onTransition\n   * @emits scion.BaseInterpreter#onDefaultEntry\n   * @emits scion.BaseInterpreter#onError\n   * @emits scion.BaseInterpreter#onBigStepBegin\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onBigStepSuspend\n   * @emits scion.BaseInterpreter#onBigStepResume\n   * @emits scion.BaseInterpreter#onSmallStepBegin\n   * @emits scion.BaseInterpreter#onSmallStepEnd\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onExitInterpreter\n   */\n  startAsync(cb) {\n      cb = this._initStart(cb);\n      this.genAsync(null, cb);\n  }\n\n  _initStart(cb){\n      if (typeof cb !== 'function') {\n          cb = nop;\n      }\n\n      this._log(\"performing initial big step\");\n\n      //We effectively need to figure out states to enter here to populate initial config. assuming root is compound state makes this simple.\n      //but if we want it to be parallel, then this becomes more complex. so when initializing the model, we add a 'fake' root state, which\n      //makes the following operation safe.\n      this._model.initialRef.forEach( s => this._configuration.add(s) );\n\n      return cb;\n  }\n\n  /** \n  * Returns state machine {@link Configuration}.\n  * @return {Configuration}\n  * @memberof BaseInterpreter.prototype \n  */\n  getConfiguration() {\n      return this._configuration.iter().map(function(s){return s.id;});\n  }\n\n  _getFullConfiguration(){\n      return this._configuration.iter().\n              map(function(s){ return [s].concat(query.getAncestors(s));},this).\n              reduce(function(a,b){return a.concat(b);},[]).    //flatten\n              reduce(function(a,b){return a.indexOf(b) > -1 ? a : a.concat(b);},[]); //uniq\n  }\n\n\n  /** \n  * @return {FullConfiguration}\n  * @memberof BaseInterpreter.prototype \n  */\n  getFullConfiguration() {\n      return this._getFullConfiguration().map(function(s){return s.id;});\n  }\n\n\n  /** \n  * @return {boolean}\n  * @memberof BaseInterpreter.prototype \n  * @param {string} stateName\n  */\n  isIn(stateName) {\n      return this.getFullConfiguration().indexOf(stateName) > -1;\n  }\n\n  /** \n  * Is the state machine in a final state?\n  * @return {boolean}\n  * @memberof BaseInterpreter.prototype \n  */\n  isFinal() {\n      return this._isInFinalState;\n  }\n\n  /** @private */\n  _performBigStep(e) {\n      let currentEvent, keepGoing, allStatesExited, allStatesEntered;\n      [allStatesExited, allStatesEntered, keepGoing, currentEvent] = this._startBigStep(e);\n\n      while (keepGoing) {\n        [currentEvent, keepGoing] = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n      }\n\n      this._finishBigStep(currentEvent, allStatesEntered, allStatesExited);\n  }\n\n  _selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited){\n      //first select with null event\n      var selectedTransitions  = this._selectTransitions(currentEvent, true);\n      if(selectedTransitions.isEmpty()){\n        let ev = this._internalEventQueue.shift();\n        if(ev){ \n          currentEvent = ev;\n          selectedTransitions = this._selectTransitions(currentEvent, false);\n        }\n      }\n\n      if(!selectedTransitions.isEmpty()){\n        this.emit('onSmallStepBegin', currentEvent);\n        let statesExited, statesEntered;\n        [statesExited, statesEntered] = this._performSmallStep(currentEvent, selectedTransitions);\n        if(statesExited) statesExited.forEach( s => allStatesExited.add(s) );\n        if(statesEntered) statesEntered.forEach( s => allStatesEntered.add(s) );\n        this.emit('onSmallStepEnd', currentEvent);\n      }\n      let keepGoing = !selectedTransitions.isEmpty() || this._internalEventQueue.length;\n      return [currentEvent, keepGoing];\n  }\n\n  _startBigStep(e){\n      this.emit('onBigStepBegin', e);\n\n      //do applyFinalize and autoforward\n      this._configuration.iter().forEach(state => {\n        if(state.invokes) state.invokes.forEach( invoke =>  {\n          if(invoke.autoforward){\n            //autoforward\n            this._scriptingContext.send({\n              target: `#_${invoke.id}`, \n              name: e.name,\n              data : e.data\n            });\n          }\n          if(invoke.id === e.invokeid){\n            //applyFinalize\n            if(invoke.finalize) invoke.finalize.forEach( action =>  this._evaluateAction(e, action));\n          } \n        })\n      }); \n\n      if (e) this._internalEventQueue.push(e);\n\n      let allStatesExited = new Set(), allStatesEntered = new Set();\n      let keepGoing = true;\n      let currentEvent = e;\n      return [allStatesEntered, allStatesExited, keepGoing, currentEvent];\n  }\n\n  _finishBigStep(e, allStatesEntered, allStatesExited, cb){\n      let statesToInvoke = Array.from(new Set([...allStatesEntered].filter(s => s.invokes && !allStatesExited.has(s)))).sort(sortInEntryOrder);\n\n      // Here we invoke whatever needs to be invoked. The implementation of 'invoke' is platform-specific\n      statesToInvoke.forEach( s => {\n          s.invokes.forEach( f =>  this._evaluateAction(e,f) )\n      });\n\n      // cancel invoke for allStatesExited\n      allStatesExited.forEach( s => {\n        if(s.invokes) s.invokes.forEach( invoke => {\n          this._scriptingContext.cancelInvoke(invoke.id);\n        })\n      });\n\n      // TODO: Invoking may have raised internal error events and we iterate to handle them        \n      //if not internalQueue.isEmpty():\n      //    continue\n\n      this._isInFinalState = this._configuration.iter().every(function(s){ return s.typeEnum === FINAL; });\n      if(this._isInFinalState){\n        this._exitInterpreter(e);\n      }\n      this.emit('onBigStepEnd', e);\n      if(cb) cb(undefined, this.getConfiguration());\n  }\n\n  _cancelAllDelayedSends(){\n    for( let timeoutOptions of this._scriptingContext._timeouts){\n      if(!timeoutOptions.sendOptions.delay) continue;\n      this._log('cancelling delayed send', timeoutOptions);\n      clearTimeout(timeoutOptions.timeoutHandle);\n      this._scriptingContext._timeouts.delete(timeoutOptions);\n    }\n    Object.keys(this._scriptingContext._timeoutMap).forEach(function(key){\n      delete this._scriptingContext._timeoutMap[key];\n    }, this);\n  }\n\n  _performBigStepAsync(e, cb) {\n      let currentEvent, keepGoing, allStatesExited, allStatesEntered;\n      [allStatesExited, allStatesEntered, keepGoing, currentEvent] = this._startBigStep(e);\n\n      function nextStep(emit){\n        this.emit(emit);\n        [currentEvent, keepGoing] = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n\n        if(keepGoing){\n          this.emit('onBigStepSuspend');\n          setImmediate(nextStep.bind(this,'onBigStepResume'));\n        }else{\n          this._finishBigStep(currentEvent, allStatesEntered, allStatesExited, cb);\n        }\n      }\n      nextStep.call(this,'onBigStepBegin');\n  }\n\n  /** @private */\n  _performSmallStep(currentEvent, selectedTransitions) {\n\n      this._log(\"selecting transitions with currentEvent\", currentEvent);\n\n      this._log(\"selected transitions\", selectedTransitions);\n\n      let statesExited,\n          statesEntered;\n\n      if (!selectedTransitions.isEmpty()) {\n\n          //we only want to enter and exit states from transitions with targets\n          //filter out targetless transitions here - we will only use these to execute transition actions\n          var selectedTransitionsWithTargets = new this.opts.Set(selectedTransitions.iter().filter(transitionWithTargets));\n\n          statesExited = this._exitStates(currentEvent, selectedTransitionsWithTargets)\n          this._executeTransitions(currentEvent, selectedTransitions);\n          statesEntered = this._enterStates(currentEvent, selectedTransitionsWithTargets)\n\n          this._log(\"new configuration \", this._configuration);\n      }\n\n      return [statesExited, statesEntered];\n  }\n\n  _exitStates(currentEvent, selectedTransitionsWithTargets){\n      let basicStatesExited, statesExited;\n      [basicStatesExited, statesExited] = this._getStatesExited(selectedTransitionsWithTargets); \n\n      this._log('exiting states')\n      for (var j = 0, len = statesExited.length; j < len; j++) {\n          var stateExited = statesExited[j];\n\n          if(stateExited.isAtomic) this._configuration.remove(stateExited);\n\n          this._log(\"exiting \", stateExited.id);\n\n          //invoke listeners\n          this.emit('onExit',stateExited.id)\n\n          if(stateExited.onExit !== undefined) {\n              for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n                  let block = stateExited.onExit[exitIdx];\n                  for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                      let actionRef = block[blockIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n\n          var f;\n          if (stateExited.historyRef) {\n              for(let historyRef of stateExited.historyRef){\n                  if (historyRef.isDeep) {\n                      f = function(s0) {\n                          return s0.typeEnum === BASIC && stateExited.descendants.indexOf(s0) > -1;\n                      };\n                  } else {\n                      f = function(s0) {\n                          return s0.parent === stateExited;\n                      };\n                  }\n                  //update history\n                  this._historyValue[historyRef.id] = statesExited.filter(f);\n              }\n          }\n      }\n\n      return statesExited;\n  }\n\n  /** @private */\n  _getStatesExited(transitions) {\n    var statesExited = new this.opts.Set();\n    var basicStatesExited = new this.opts.Set();\n\n    //States exited are defined to be active states that are\n    //descendants of the scope of each priority-enabled transition.\n    //Here, we iterate through the transitions, and collect states\n    //that match this condition. \n    var transitionList = transitions.iter();\n    for (var txIdx = 0, txLen = transitionList.length; txIdx < txLen; txIdx++) {\n      var transition = transitionList[txIdx];\n      var scope = transition.scope,\n          desc = scope.descendants;\n\n      //For each state in the configuration\n      //is that state a descendant of the transition scope?\n      //Store ancestors of that state up to but not including the scope.\n      var configList = this._configuration.iter();\n      for (var cfgIdx = 0, cfgLen = configList.length; cfgIdx < cfgLen; cfgIdx++) {\n        var state = configList[cfgIdx];\n        if(desc.indexOf(state) > -1){\n          basicStatesExited.add(state);\n          statesExited.add(state);\n          var ancestors = query.getAncestors(state,scope); \n          for (var ancIdx = 0, ancLen = ancestors.length; ancIdx < ancLen; ancIdx++) { \n            statesExited.add(ancestors[ancIdx]);\n          }\n        }\n      }\n    }\n\n    var sortedStatesExited = statesExited.iter().sort(getStateWithHigherSourceChildPriority);\n    return [basicStatesExited, sortedStatesExited];\n  }\n\n  _executeTransitions(currentEvent, selectedTransitions){\n      var sortedTransitions = selectedTransitions.iter().sort(transitionComparator);\n\n      this._log(\"executing transitition actions\");\n      for (var stxIdx = 0, len = sortedTransitions.length; stxIdx < len; stxIdx++) {\n          var transition = sortedTransitions[stxIdx];\n\n          var targetIds = transition.targets && transition.targets.map(function(target){return target.id;});\n\n          this.emit('onTransition',transition.source.id,targetIds, transition.source.transitions.indexOf(transition));\n\n          if(transition.onTransition !== undefined) {\n              for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                  let actionRef = transition.onTransition[txIdx];\n                  try {\n                    actionRef.call(this._scriptingContext, currentEvent);\n                  } catch (e){\n                    this._handleError(e, actionRef);\n                    break;\n                  }\n              }\n          }\n      }\n  }\n\n  _enterStates(currentEvent, selectedTransitionsWithTargets){\n      this._log(\"entering states\");\n\n      let statesEntered = new Set();\n      let statesForDefaultEntry = new Set();\n      // initialize the temporary table for default content in history states\n      let defaultHistoryContent = {};\n      this._computeEntrySet(selectedTransitionsWithTargets, statesEntered, statesForDefaultEntry, defaultHistoryContent); \n      statesEntered = Array.from(statesEntered).sort(sortInEntryOrder); \n\n      this._log(\"statesEntered \", statesEntered);\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n          var stateEntered = statesEntered[enterIdx];\n\n          if(stateEntered.isAtomic) this._configuration.add(stateEntered);\n\n          this._log(\"entering\", stateEntered.id);\n\n          this.emit('onEntry',stateEntered.id);\n\n          if(stateEntered.onEntry !== undefined) {\n              for (var entryIdx = 0, entryLen = stateEntered.onEntry.length; entryIdx < entryLen; entryIdx++) {\n                  let block = stateEntered.onEntry[entryIdx];\n                  for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                      let actionRef = block[blockIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n\n          if(statesForDefaultEntry.has(stateEntered)){\n              for(let initialState of stateEntered.initialRef){\n                  this.emit('onDefaultEntry', initialState.id);\n                  if(initialState.typeEnum === INITIAL){\n                      let transition = initialState.transitions[0]\n                      if(transition.onTransition !== undefined) {\n                          this._log('executing initial transition content for initial state of parent state',stateEntered.id);\n                          for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                              let actionRef = transition.onTransition[txIdx];\n                              try {\n                                actionRef.call(this._scriptingContext, currentEvent);\n                              } catch (e){\n                                this._handleError(e, actionRef);\n                                break;\n                              }\n                          }\n                      }\n                  }\n              }\n          }\n\n\n          if(defaultHistoryContent[stateEntered.id]){\n              let transition = defaultHistoryContent[stateEntered.id]\n              if(transition.onTransition !== undefined) {\n                  this._log('executing history transition content for history state of parent state',stateEntered.id);\n                  for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                      let actionRef = transition.onTransition[txIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n      }\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n          var stateEntered = statesEntered[enterIdx];\n          if(stateEntered.typeEnum === FINAL){\n            let parent = stateEntered.parent;\n            let grandparent = parent.parent;\n            this._internalEventQueue.push({name : \"done.state.\" + parent.id, data : stateEntered.donedata && stateEntered.donedata.call(this._scriptingContext, currentEvent)});\n            if(grandparent && grandparent.typeEnum === PARALLEL){\n                if(grandparent.states.every(s => this.isInFinalState(s) )){\n                    this._internalEventQueue.push({name : \"done.state.\" + grandparent.id});\n                }\n            }\n          }\n      }\n\n      return statesEntered;\n  }\n\n  _getEffectiveTargetStates(transition){\n    let targets = new Set();\n    for(let s of transition.targets){\n      if(s.typeEnum === HISTORY){\n        if(s.id in this._historyValue)\n          this._historyValue[s.id].forEach( state => targets.add(state))\n        else\n          [...this._getEffectiveTargetStates(s.transitions[0])].forEach( state => targets.add(state))\n      } else {\n        targets.add(s)\n      }\n    }\n    return targets\n  }\n\n  _computeEntrySet(transitions, statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    for(let t of transitions.iter()){\n      for(let s of t.targets){\n        this._addDescendantStatesToEnter(s,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n      }\n      let ancestor = t.scope;\n      for(let s of this._getEffectiveTargetStates(t)){\n        this._addAncestorStatesToEnter(s, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n      }\n    }\n  }\n\n  _computeExitSet(transitions) {\n    let statesToExit = new Set();\n    for(let t of transitions){\n      if(t.targets){\n        let scope = t.scope;\n        for(let s of this._getFullConfiguration()){\n          if(query.isDescendant(s,scope)) statesToExit.add(s);\n        }\n      }\n    }\n    return statesToExit; \n  }\n\n  _addAncestorStatesToEnter(state, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    let traverse = (anc) => {\n      if(anc.typeEnum === PARALLEL){\n        for(let child of anc.states){\n          if(child.typeEnum !== HISTORY && ![...statesToEnter].some(s => query.isDescendant(s, child))){\n            this._addDescendantStatesToEnter(child,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n          }\n        }\n      }\n    };\n    for(let anc of query.getAncestors(state,ancestor)){\n      statesToEnter.add(anc)\n      traverse(anc)\n    }\n    traverse(ancestor)\n  }\n\n\n  _addDescendantStatesToEnter(state,statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    if(state.typeEnum === HISTORY){\n      if(this._historyValue[state.id]){\n        for(let s of this._historyValue[state.id])\n          this._addDescendantStatesToEnter(s,statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n\n        for(let s of this._historyValue[state.id])\n          this._addAncestorStatesToEnter(s, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n      } else {\n        defaultHistoryContent[state.parent.id] = state.transitions[0]\n        for(let s of state.transitions[0].targets)\n          this._addDescendantStatesToEnter(s,statesToEnter,statesForDefaultEntry, defaultHistoryContent)\n\n        for(let s of state.transitions[0].targets)\n          this._addAncestorStatesToEnter(s, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n\n      }\n    } else {\n      statesToEnter.add(state)\n        if(state.typeEnum === COMPOSITE){\n          statesForDefaultEntry.add(state)\n          //for each state in initialRef, if it is an initial state, then add ancestors and descendants.\n          for(let s of state.initialRef){\n            let targets = s.typeEnum === INITIAL ? s.transitions[0].targets : [s]; \n            for(let targetState of targets){\n              this._addDescendantStatesToEnter(targetState,statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n            }\n          }\n          for(let s of state.initialRef){\n            let targets = s.typeEnum === INITIAL ? s.transitions[0].targets : [s]; \n            for(let targetState of targets){\n              this._addAncestorStatesToEnter(targetState, state, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n            }\n          }\n        }else{\n          if(state.typeEnum === PARALLEL){\n            for(let child of state.states){\n              if(child.typeEnum !== HISTORY && ![...statesToEnter].some(s => query.isDescendant(s, child))){\n                this._addDescendantStatesToEnter(child,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n              }\n            }\n          }\n        }\n    }\n  }\n\n  isInFinalState(s){\n      if(s.typeEnum === COMPOSITE){\n          return s.states.some(s => s.typeEnum === FINAL && this._configuration.contains(s));\n      }else if(s.typeEnum === PARALLEL){\n          return s.states.every(this.isInFinalState.bind(this))\n      }else{\n          return false\n      }\n  }\n\n  /** @private */\n  _evaluateAction(currentEvent, actionRef) {\n      try {\n        return actionRef.call(this._scriptingContext, currentEvent);     //SCXML system variables\n      } catch (e){\n        this._handleError(e, actionRef);\n      }\n  }\n\n  _handleError(e, actionRef){\n    let event = \n      e instanceof Error || (typeof e.__proto__.name === 'string' && e.__proto__.name.match(/^.*Error$/)) ?  //we can't just do 'e instanceof Error', because the Error object in the sandbox is from a different context, and instanceof will return false\n        {\n          name:'error.execution',\n          data : {\n            tagname: actionRef.tagname, \n            line: actionRef.line, \n            column: actionRef.column,\n            reason: e.message\n          },\n          type : 'platform'\n        } : \n        (e.name ? \n          e : \n          {\n            name:'error.execution',\n            data:e,\n            type : 'platform'\n          }\n        );\n    this._internalEventQueue.push(event);\n    this.emit('onError', event);\n  }\n\n  _log(){\n    if(printTrace){\n      var args = Array.from(arguments);\n      this.opts.console.log( \n        `${args[0]}: ${\n          args.slice(1).map(function(arg){\n            return arg === null ? 'null' : \n              ( arg === undefined ? 'undefined' : \n                ( typeof arg === 'string' ? arg : \n                  ( arg.toString() === '[object Object]' ? util.inspect(arg) : arg.toString())));\n\n          }).join(', ')\n        }\\n`\n      );\n    }\n  }\n\n  /**\n  * @interface Listener\n  */\n\n  /**\n  * @function\n  * @name Listener#onEntry \n  * @param {string} stateId\n  */\n\n  /**\n  * @function\n  * @name Listener#onExit \n  * @param {string} stateId\n  */\n\n  /**\n  * @function\n  * @name Listener#onTransition \n  * @param {string} sourceStateId Id of the source state\n  * @param {Array<string>} targetStatesIds Ids of the target states\n  * @param {number} transitionIndex Index of the transition relative to other transitions originating from source state.\n  */\n\n  /**\n  * @function\n  * @name Listener#onError\n  * @param {Error} errorInfo\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepBegin\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepResume\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepSuspend\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepEnd\n  */\n\n  /**\n  * @function\n  * @name Listener#onSmallStepBegin\n  * @param {string} event\n  */\n\n  /**\n  * @function\n  * @name Listener#onSmallStepEnd\n  */\n\n\n  /** \n  * Provides a generic mechanism to subscribe to state change and runtime\n  * error notifications.  Can be used for logging and debugging. For example,\n  * can attach a logger that simply logs the state changes.  Or can attach a\n  * network debugging client that sends state change notifications to a\n  * debugging server.\n  * This is an alternative interface to {@link EventEmitter.prototype#on}.\n  * @memberof BaseInterpreter.prototype \n  * @param {Listener} listener\n  */\n  registerListener(listener){\n      BaseInterpreter.EVENTS.forEach(function(event){\n        if(listener[event]) this.on(event,listener[event]);\n      }, this);\n  }\n\n  /** \n  * Unregister a Listener\n  * @memberof BaseInterpreter.prototype \n  * @param {Listener} listener\n  */\n  unregisterListener(listener){\n      BaseInterpreter.EVENTS.forEach(function(event){\n        if(listener[event]) this.off(event,listener[event]);\n      }, this);\n  }\n\n  /** \n  * Query the model to get all transition events.\n  * @return {Array<string>} Transition events.\n  * @memberof BaseInterpreter.prototype \n  */\n  getAllTransitionEvents(){\n      var events = {};\n      function getEvents(state){\n\n          if(state.transitions){\n              for (var txIdx = 0, txLen = state.transitions.length; txIdx < txLen; txIdx++) {\n                  events[state.transitions[txIdx].event] = true;\n              }\n          }\n\n          if(state.states) {\n              for (var stateIdx = 0, stateLen = state.states.length; stateIdx < stateLen; stateIdx++) {\n                  getEvents(state.states[stateIdx]);\n              }\n          }\n      }\n\n      getEvents(this._model);\n\n      return Object.keys(events);\n  }\n\n  /**\n  * Three things capture the current snapshot of a running SCION interpreter:\n  *\n  *      <ul>\n  *      <li> basic configuration (the set of basic states the state machine is in)</li>\n  *      <li> history state values (the states the state machine was in last time it was in the parent of a history state)</li>\n  *      <li> the datamodel</li>\n  *      </ul>\n  *      \n  * The snapshot object can be serialized as JSON and saved to a database. It can\n  * later be passed to the SCXML constructor to restore the state machine\n  * using the snapshot argument.\n  *\n  * @return {Snapshot} \n  * @memberof BaseInterpreter.prototype \n  */\n  getSnapshot(){\n    return [\n      this.getConfiguration(),\n      this._serializeHistory(),\n      this._isInFinalState,\n      this._model.$serializeDatamodel(),\n      this._internalEventQueue.slice()\n    ];\n  }\n\n  _serializeHistory(){\n    var o = {};\n    Object.keys(this._historyValue).forEach(function(sid){\n      o[sid] = this._historyValue[sid].map(function(state){return state.id});\n    },this);\n    return o;\n  }\n\n\n  /**\n   * @interface Event\n   */\n\n  /** \n  * @member name\n  * @memberof Event.prototype \n  * @type string\n  * @description The name of the event\n  */\n\n  /** \n  * @member data\n  * @memberof Event.prototype \n  * @type any\n  * @description The event data\n  */\n\n  /** \n  * An SCXML interpreter takes SCXML events as input, where an SCXML event is an\n  * object with \"name\" and \"data\" properties. These can be passed to method `gen`\n  * as two positional arguments, or as a single object.\n  * @param {string|Event} evtObjOrName\n  * @param {any=} optionalData\n  * @emits scion.BaseInterpreter#onEntry\n  * @emits scion.BaseInterpreter#onExit\n  * @emits scion.BaseInterpreter#onTransition\n  * @emits scion.BaseInterpreter#onDefaultEntry\n  * @emits scion.BaseInterpreter#onError\n  * @emits scion.BaseInterpreter#onBigStepBegin\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onBigStepSuspend\n  * @emits scion.BaseInterpreter#onBigStepResume\n  * @emits scion.BaseInterpreter#onSmallStepBegin\n  * @emits scion.BaseInterpreter#onSmallStepEnd\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onExitInterpreter\n  */\n  gen(evtObjOrName,optionalData) {\n    var currentEvent;\n    switch(typeof evtObjOrName){\n      case 'string':\n        currentEvent = {name : evtObjOrName, data : optionalData};\n        break;\n      case 'object':\n        if(typeof evtObjOrName.name === 'string'){\n          currentEvent = evtObjOrName;\n        }else{\n          throw new Error('Event object must have \"name\" property of type string.');\n        }\n        break;\n      default:\n        throw new Error('First argument to gen must be a string or object.');\n    }\n\n    if(this._isStepping) throw new Error('Cannot call gen during a big-step');\n\n    //otherwise, kick him off\n    this._isStepping = true;\n\n    this._performBigStep(currentEvent);\n\n    this._isStepping = false;\n    return this.getConfiguration();\n  }\n\n  /**\n  * Injects an external event into the interpreter asynchronously\n  * @param {Event}  currentEvent The event to inject\n  * @param {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n  * @emits scion.BaseInterpreter#onEntry\n  * @emits scion.BaseInterpreter#onExit\n  * @emits scion.BaseInterpreter#onTransition\n  * @emits scion.BaseInterpreter#onDefaultEntry\n  * @emits scion.BaseInterpreter#onError\n  * @emits scion.BaseInterpreter#onBigStepBegin\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onBigStepSuspend\n  * @emits scion.BaseInterpreter#onBigStepResume\n  * @emits scion.BaseInterpreter#onSmallStepBegin\n  * @emits scion.BaseInterpreter#onSmallStepEnd\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onExitInterpreter\n  */\n  genAsync(currentEvent, cb) {\n    if (currentEvent !== null && (typeof currentEvent !== 'object' || !currentEvent || typeof currentEvent.name !== 'string')) {\n      throw new Error('Expected currentEvent to be null or an Object with a name');\n    }\n    \n    if (typeof cb !== 'function') {\n      cb = nop;\n    }\n\n    this._externalEventQueue.push([currentEvent, cb]);\n\n    //the semantics we want are to return to the cb the results of processing that particular event.\n    function nextStep(e, c){\n      this._performBigStepAsync(e, function(err, config) {\n        c(err, config);\n\n        if(this._externalEventQueue.length){\n          nextStep.apply(this,this._externalEventQueue.shift());\n        }else{\n          this._isStepping = false;\n        }\n      }.bind(this));\n    }\n    if(!this._isStepping){ \n      this._isStepping = true;\n      nextStep.apply(this,this._externalEventQueue.shift());\n    }\n  }\n}\n\nBaseInterpreter.EVENTS = [\n  'onEntry',\n  'onExit',\n  'onTransition',\n  'onDefaultEntry',\n  'onError',\n  'onBigStepBegin',\n  'onBigStepSuspend',\n  'onBigStepResume',\n  'onSmallStepBegin',\n  'onSmallStepEnd',\n  'onBigStepEnd',\n  'onExitInterpreter'\n];\n\n//some global singletons to use to generate in-memory session ids, in case the user does not specify these data structures\nBaseInterpreter.sessionIdCounter = 1;\nBaseInterpreter.generateSessionid = function(){\n  return BaseInterpreter.sessionIdCounter++;\n}\nBaseInterpreter.sessionRegistry = new Map();\n\n// Do nothing\n\nfunction nop() {}\n\n\nclass InterpreterScriptingContext{\n  constructor(interpreter){ \n    this._interpreter = interpreter;\n    this._timeoutMap = {};\n    this._invokeMap = {};\n    this._timeouts = new Set()\n\n    //Regex from:\n    //  http://daringfireball.net/2010/07/improved_regex_for_matching_urls\n    //  http://stackoverflow.com/a/6927878\n    this.validateUriRegex = /(#_.*)|\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?]))/i;\n\n    this.invokeSendTargetRegex = /^#_(.*)$/;\n    this.scxmlSendTargetRegex = /^#_scxml_(.*)$/;\n  }\n\n\n  raise(event){\n    this._installDefaultPropsOnEvent(event, true);\n    this._interpreter._internalEventQueue.push(event); \n  }\n\n  parseXmlStringAsDOM(xmlString){\n    return (this._interpreter.opts.xmlParser || InterpreterScriptingContext.xmlParser).parse(xmlString);\n  }\n\n  invoke(invokeObj){\n    //look up invoker by type. assume invokers are passed in as an option to constructor\n    this._invokeMap[invokeObj.id] = new Promise((resolve, reject) => {\n      (this._interpreter.opts.invokers || InterpreterScriptingContext.invokers)[invokeObj.type](this._interpreter, invokeObj, this._interpreter.opts.invokerExecutionContext, (err, session) => {\n        if(err) return reject(err);\n\n        this._interpreter.emit('onInvokedSessionInitialized', session);\n        resolve(session);\n      });\n    });\n  }\n\n  cancelInvoke(invokeid){\n    //TODO: on cancel invoke clean up this._invokeMap\n    let sessionPromise = this._invokeMap[invokeid];\n    this._interpreter._log(`cancelling session with invokeid ${invokeid}`);\n    if(sessionPromise){\n      this._interpreter._log(`sessionPromise found`);\n      sessionPromise.then( \n        ((session) => {\n          this._interpreter._log(`resolved session ${invokeid}. cancelling... `);\n          session.cancel(); \n          //clean up\n          delete this._invokeMap[invokeid];\n        }), \n        ( (err) => {\n          //TODO: dispatch error back into the state machine as error.communication\n        }));\n    }\n  }\n\n  _installDefaultPropsOnEvent(event,isInternal){\n    if(!isInternal){ \n      event.origin = this._interpreter.opts._x._ioprocessors.scxml.location;     //TODO: preserve original origin when we autoforward? \n      event.origintype = event.type || SCXML_IOPROCESSOR_TYPE;\n    }\n    if(typeof event.type === 'undefined'){\n      event.type = isInternal ? 'internal' : 'external';\n    }\n    [\n      'name',\n      'sendid',\n      'invokeid',\n      'data',\n      'origin',\n      'origintype'\n    ].forEach(prop => {\n      if(typeof event[prop] === 'undefined'){\n        event[prop] = undefined;\n      }\n    });\n  }\n\n  send(event, options){\n    this._interpreter._log('send event', event, options);\n    options = options || {};\n    var sendType = options.type || SCXML_IOPROCESSOR_TYPE;\n    //TODO: move these out\n    function validateSend(event, options, sendAction){\n      if(event.target){\n        var targetIsValidUri = this.validateUriRegex.test(event.target)\n        if(!targetIsValidUri){\n          throw { name : \"error.execution\", data: 'Target is not valid URI', sendid: event.sendid, type : 'platform' };\n        }\n      }\n      if( sendType !== SCXML_IOPROCESSOR_TYPE) {  //TODO: extend this to support HTTP, and other IO processors\n        throw { name : \"error.execution\", data: 'Unsupported event processor type', sendid: event.sendid, type : 'platform' };\n      }\n\n      sendAction.call(this, event, options);\n    }\n\n    function defaultSendAction (event, options) {\n\n      if( typeof setTimeout === 'undefined' ) throw new Error('Default implementation of BaseInterpreter.prototype.send will not work unless setTimeout is defined globally.');\n\n      var match;\n      if(event.target === '#_internal'){\n        this.raise(event);\n      }else{ \n        this._installDefaultPropsOnEvent(event, false);\n        event.origintype = SCXML_IOPROCESSOR_TYPE;      //TODO: extend this to support HTTP, and other IO processors\n                                                        //TODO : paramterize this based on send/@type?\n        if(!event.target){\n          doSend.call(this, this._interpreter);\n        }else if(event.target === '#_parent'){\n          if(this._interpreter.opts.parentSession){\n            event.invokeid = this._interpreter.opts.invokeid;\n            doSend.call(this, this._interpreter.opts.parentSession);\n          }else{\n            throw { name : \"error.communication\", data: 'Parent session not specified', sendid: event.sendid, type : 'platform' };\n          }\n        } else if(match = event.target.match(this.scxmlSendTargetRegex)){\n          let targetSessionId = match[1];\n          let session = this._interpreter.opts.sessionRegistry.get(targetSessionId)\n          if(session){\n            doSend.call(this,session);\n          }else {\n            throw {name : 'error.communication', sendid: event.sendid, type : 'platform'};\n          }\n        }else if(match = event.target.match(this.invokeSendTargetRegex)){\n          //TODO: test this code path.\n          var invokeId = match[1]\n          this._invokeMap[invokeId].then( (session) => {\n            doSend.call(this,session);\n          })\n        } else {\n          throw new Error('Unrecognized send target.'); //TODO: dispatch error back into the state machine\n        }\n      }\n\n      function doSend(session){\n        //TODO: we probably now need to refactor data structures:\n        //    this._timeouts\n        //    this._timeoutMap\n        var timeoutHandle = setTimeout(function(){\n          if (event.sendid) delete this._timeoutMap[event.sendid];\n          this._timeouts.delete(timeoutOptions);\n          if(this._interpreter.opts.doSend){\n            this._interpreter.opts.doSend(session, event);\n          }else{\n            session[this._interpreter.opts.sendAsync ? 'genAsync' : 'gen'](event);\n          }\n        }.bind(this), options.delay || 0);\n\n        var timeoutOptions = {\n          sendOptions : options,\n          timeoutHandle : timeoutHandle\n        };\n        if (event.sendid) this._timeoutMap[event.sendid] = timeoutHandle;\n        this._timeouts.add(timeoutOptions); \n      }\n    }\n\n    function publish(){\n      this._interpreter.emit(event.name,event.data);\n    }\n\n    //choose send function\n    //TODO: rethink how this custom send works\n    var sendFn;         \n    if(event.type === 'https://github.com/jbeard4/SCION#publish'){\n      sendFn = publish;\n    }else if(this._interpreter.opts.customSend){\n      sendFn = this._interpreter.opts.customSend;\n    }else{\n      sendFn = defaultSendAction;\n    }\n\n    options=options || {};\n\n    this._interpreter._log(\"sending event\", event.name, \"with content\", event.data, \"after delay\", options.delay);\n\n    validateSend.call(this, event, options, sendFn);\n  }\n\n  cancel(sendid){\n    if(this._interpreter.opts.customCancel) {\n      return this._interpreter.opts.customCancel.apply(this, [sendid]);\n    }\n\n    if( typeof clearTimeout === 'undefined' ) throw new Error('Default implementation of BaseInterpreter.prototype.cancel will not work unless setTimeout is defined globally.');\n\n    if (sendid in this._timeoutMap) {\n      this._interpreter._log(\"cancelling \", sendid, \" with timeout id \", this._timeoutMap[sendid]);\n      clearTimeout(this._timeoutMap[sendid]);\n    }\n  }\n}\n\nmodule.exports = extend(new EventEmitter, {\n    BaseInterpreter: BaseInterpreter,\n    ArraySet : ArraySet,\n    STATE_TYPES : constants.STATE_TYPES,\n    initializeModel : initializeModel,\n    InterpreterScriptingContext : InterpreterScriptingContext,\n    helpers: helpers,\n    query: query\n});\n","function EventEmitter() {\n    this._listeners = {};\n}\n\nEventEmitter.prototype.on = function _on(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        this._listeners[type] = [];\n    }\n\n    if (this._listeners[type].indexOf(listener) === -1) {\n        this._listeners[type].push(listener);\n    }\n\n    return this;\n};\n\nEventEmitter.prototype.once = function _once(type, listener) {\n    var self = this;\n\n    function __once() {\n        for (var args = [], i = 0; i < arguments.length; i += 1) {\n            args[i] = arguments[i];\n        }\n\n        self.off(type, __once);\n        listener.apply(self, args);\n    }\n\n    __once.listener = listener;\n\n    return this.on(type, __once);\n};\n\nEventEmitter.prototype.off = function _off(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    if (typeof listener === 'undefined') {\n        this._listeners[type] = [];\n        return this;\n    }\n\n    var index = this._listeners[type].indexOf(listener);\n\n    if (index === -1) {\n        for (var i = 0; i < this._listeners[type].length; i += 1) {\n            if (this._listeners[type][i].listener === listener) {\n                index = i;\n                break;\n            }\n        }\n    }\n\n    this._listeners[type].splice(index, 1);\n    return this;\n};\n\nEventEmitter.prototype.emit = function _emit(type) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    for (var args = [], i = 1; i < arguments.length; i += 1) {\n        args[i - 1] = arguments[i];\n    }\n\n    this._listeners[type].forEach(function __emit(listener) {\n        listener.apply(this, args);\n    }, this);\n\n    return this;\n};\n\nmodule.exports.EventEmitter = EventEmitter;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors ||\n  function getOwnPropertyDescriptors(obj) {\n    var keys = Object.keys(obj);\n    var descriptors = {};\n    for (var i = 0; i < keys.length; i++) {\n      descriptors[keys[i]] = Object.getOwnPropertyDescriptor(obj, keys[i]);\n    }\n    return descriptors;\n  };\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  if (typeof process !== 'undefined' && process.noDeprecation === true) {\n    return fn;\n  }\n\n  // Allow for deprecating things in the process of starting up.\n  if (typeof process === 'undefined') {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nvar kCustomPromisifiedSymbol = typeof Symbol !== 'undefined' ? Symbol('util.promisify.custom') : undefined;\n\nexports.promisify = function promisify(original) {\n  if (typeof original !== 'function')\n    throw new TypeError('The \"original\" argument must be of type Function');\n\n  if (kCustomPromisifiedSymbol && original[kCustomPromisifiedSymbol]) {\n    var fn = original[kCustomPromisifiedSymbol];\n    if (typeof fn !== 'function') {\n      throw new TypeError('The \"util.promisify.custom\" argument must be of type Function');\n    }\n    Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n      value: fn, enumerable: false, writable: false, configurable: true\n    });\n    return fn;\n  }\n\n  function fn() {\n    var promiseResolve, promiseReject;\n    var promise = new Promise(function (resolve, reject) {\n      promiseResolve = resolve;\n      promiseReject = reject;\n    });\n\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    args.push(function (err, value) {\n      if (err) {\n        promiseReject(err);\n      } else {\n        promiseResolve(value);\n      }\n    });\n\n    try {\n      original.apply(this, args);\n    } catch (err) {\n      promiseReject(err);\n    }\n\n    return promise;\n  }\n\n  Object.setPrototypeOf(fn, Object.getPrototypeOf(original));\n\n  if (kCustomPromisifiedSymbol) Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n    value: fn, enumerable: false, writable: false, configurable: true\n  });\n  return Object.defineProperties(\n    fn,\n    getOwnPropertyDescriptors(original)\n  );\n}\n\nexports.promisify.custom = kCustomPromisifiedSymbol\n\nfunction callbackifyOnRejected(reason, cb) {\n  // `!reason` guard inspired by bluebird (Ref: https://goo.gl/t5IS6M).\n  // Because `null` is a special error value in callbacks which means \"no error\n  // occurred\", we error-wrap so the callback consumer can distinguish between\n  // \"the promise rejected with null\" or \"the promise fulfilled with undefined\".\n  if (!reason) {\n    var newReason = new Error('Promise was rejected with a falsy value');\n    newReason.reason = reason;\n    reason = newReason;\n  }\n  return cb(reason);\n}\n\nfunction callbackify(original) {\n  if (typeof original !== 'function') {\n    throw new TypeError('The \"original\" argument must be of type Function');\n  }\n\n  // We DO NOT return the promise as it gives the user a false sense that\n  // the promise is actually somehow related to the callback's execution\n  // and that the callback throwing will reject the promise.\n  function callbackified() {\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n\n    var maybeCb = args.pop();\n    if (typeof maybeCb !== 'function') {\n      throw new TypeError('The last argument must be of type Function');\n    }\n    var self = this;\n    var cb = function() {\n      return maybeCb.apply(self, arguments);\n    };\n    // In true node style we process the callback on `nextTick` with all the\n    // implications (stack, `uncaughtException`, `async_hooks`)\n    original.apply(this, args)\n      .then(function(ret) { process.nextTick(cb, null, ret) },\n            function(rej) { process.nextTick(callbackifyOnRejected, rej, cb) });\n  }\n\n  Object.setPrototypeOf(callbackified, Object.getPrototypeOf(original));\n  Object.defineProperties(callbackified,\n                          getOwnPropertyDescriptors(original));\n  return callbackified;\n}\nexports.callbackify = callbackify;\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","/* begin ArraySet */\n\n/** @constructor */\nfunction ArraySet(l) {\n    l = l || [];\n    this.o = new Set(l);        \n}\n\nArraySet.prototype = {\n\n    add : function(x) {\n        this.o.add(x);\n    },\n\n    remove : function(x) {\n        return this.o.delete(x);\n    },\n\n    union : function(l) {\n        for (var v of l.o) {\n            this.o.add(v);\n        }\n        return this;\n    },\n\n    difference : function(l) {\n        for (var v of l.o) {\n            this.o.delete(v);\n        }\n        return this;\n    },\n\n    contains : function(x) {\n        return this.o.has(x);\n    },\n\n    iter : function() {\n        return Array.from(this.o);\n    },\n\n    isEmpty : function() {\n        return !this.o.size;\n    },\n\n    size: function() {\n        return this.o.size;\n    },\n\n    equals : function(s2) {\n        if (this.o.size !== s2.size()) {\n            return false;\n        }\n\n        for (var v of this.o) {\n            if (!s2.contains(v)) {\n                return false;\n            }\n        }\n\n        return true;\n    },\n\n    toString : function() {\n        return this.o.size === 0 ? '<empty>' : Array.from(this.o).join(',\\n');\n    }\n};\n\nmodule.exports = ArraySet;\n","const constants = require('./constants'),\n      STATE_TYPES = constants.STATE_TYPES,\n      RX_TRAILING_WILDCARD = constants.RX_TRAILING_WILDCARD;\n\nconst printTrace = false;\n\nmodule.exports = {\n  extend : extend,\n  transitionWithTargets : transitionWithTargets,\n  transitionComparator : transitionComparator,\n  initializeModel : initializeModel,\n  isEventPrefixMatch : isEventPrefixMatch,\n  isTransitionMatch : isTransitionMatch,\n  scxmlPrefixTransitionSelector : scxmlPrefixTransitionSelector,\n  eventlessTransitionSelector : eventlessTransitionSelector,\n  getTransitionWithHigherSourceChildPriority : getTransitionWithHigherSourceChildPriority,\n  sortInEntryOrder : sortInEntryOrder,\n  getStateWithHigherSourceChildPriority : getStateWithHigherSourceChildPriority,\n  initializeModelGeneratorFn : initializeModelGeneratorFn,\n  deserializeSerializedConfiguration : deserializeSerializedConfiguration,\n  deserializeHistory : deserializeHistory\n};\n\nfunction extend (to, from){\n  Object.keys(from).forEach(function(k){\n    to[k] = from[k]; \n  });\n  return to;\n};\n\nfunction transitionWithTargets(t){\n    return t.targets;\n}\n\nfunction transitionComparator(t1, t2) {\n    return t1.documentOrder - t2.documentOrder;\n}\n\nfunction initializeModel(rootState, opts){\n    var transitions = [], idToStateMap = new Map(), documentOrder = 0;\n\n\n    //TODO: need to add fake ids to anyone that doesn't have them\n    //FIXME: make this safer - break into multiple passes\n    var idCount = {};\n\n    function generateId(type){\n        if(idCount[type] === undefined) idCount[type] = 0;\n\n        do {\n          var count = idCount[type]++;\n          var id = '$generated-' + type + '-' + count; \n        } while (idToStateMap.has(id))\n        \n        return id;\n    }\n\n    function wrapInFakeRootState(state){\n        return {\n            $deserializeDatamodel : state.$deserializeDatamodel || function(){},\n            $serializeDatamodel : state.$serializeDatamodel || function(){ return null;},\n            $idToStateMap : idToStateMap,   //keep this for handy deserialization of serialized configuration\n            docUrl : state.docUrl,\n            name : state.name,\n            states : [\n                {\n                    $type : 'initial',\n                    transitions : [{\n                        target : state\n                    }]\n                },\n                state\n            ]\n        };\n    }\n\n    var statesWithInitialAttributes = [];\n\n    /**\n      @this {SCTransition}\n    */\n    function transitionToString(sourceState){\n      return `${sourceState} -- ${this.events ? '(' + this.events.join(',') + ')' : null}${this.cond ? '[' + this.cond.name + ']' : ''} --> ${this.targets ? this.targets.join(',') : null}`;\n    }\n\n    /**\n      @this {SCState}\n    */\n    function stateToString(){\n      return this.id;\n    }\n\n    function populateStateIdMap(state){\n      //populate state id map\n      if(state.id){\n          idToStateMap.set(state.id, state);\n      }\n\n      if(state.states) {\n          for (var j = 0, len = state.states.length; j < len; j++) {\n              populateStateIdMap(state.states[j]);\n          }\n      }\n    }\n\n    function traverse(ancestors,state){\n\n        if(printTrace) state.toString = stateToString;\n\n        //add to global transition and state id caches\n        if(state.transitions) transitions.push.apply(transitions,state.transitions);\n\n        //create a default type, just to normalize things\n        //this way we can check for unsupported types below\n        state.$type = state.$type || 'state';\n\n        //add ancestors and depth properties\n        state.ancestors = ancestors;\n        state.depth = ancestors.length;\n        state.parent = ancestors[0];\n        state.documentOrder = documentOrder++; \n\n        //add some information to transitions\n        state.transitions = state.transitions || [];\n        for (var j = 0, len = state.transitions.length; j < len; j++) {\n            var transition = state.transitions[j];\n            transition.documentOrder = documentOrder++; \n            transition.source = state;\n            if(printTrace) transition.toString = transitionToString.bind(transition, state);\n        };\n\n        //recursive step\n        if(state.states) {\n            var ancs = [state].concat(ancestors);\n            for (var j = 0, len = state.states.length; j < len; j++) {\n                traverse(ancs, state.states[j]);\n            }\n        }\n\n        //setup fast state type\n        switch(state.$type){\n            case 'parallel':\n                state.typeEnum = STATE_TYPES.PARALLEL;\n                state.isAtomic = false;\n                break;\n            case 'initial' : \n                state.typeEnum = STATE_TYPES.INITIAL;\n                state.isAtomic = true;\n                break;\n            case 'history' :\n                state.typeEnum = STATE_TYPES.HISTORY;\n                state.isAtomic = true;\n                break;\n            case 'final' : \n                state.typeEnum = STATE_TYPES.FINAL;\n                state.isAtomic = true;\n                break;\n            case 'state' : \n            case 'scxml' :\n                if(state.states && state.states.length){\n                    state.typeEnum = STATE_TYPES.COMPOSITE;\n                    state.isAtomic = false;\n                }else{\n                    state.typeEnum = STATE_TYPES.BASIC;\n                    state.isAtomic = true;\n                }\n                break;\n            default :\n                throw new Error('Unknown state type: ' + state.$type);\n        }\n\n        //descendants property on states will now be populated. add descendants to this state\n        if(state.states){\n            state.descendants = state.states.concat(state.states.map(function(s){return s.descendants;}).reduce(function(a,b){return a.concat(b);},[]));\n        }else{\n            state.descendants = [];\n        }\n\n        var initialChildren;\n        if(state.typeEnum === STATE_TYPES.COMPOSITE){\n            //set up initial state\n            \n            if(Array.isArray(state.initial) || typeof state.initial === 'string'){\n                statesWithInitialAttributes.push(state);\n            }else{\n                //take the first child that has initial type, or first child\n                initialChildren = state.states.filter(function(child){\n                    return child.$type === 'initial';\n                });\n\n                state.initialRef = [initialChildren.length ? initialChildren[0] : state.states[0]];\n                checkInitialRef(state);\n            }\n\n        }\n\n        //hook up history\n        if(state.typeEnum === STATE_TYPES.COMPOSITE ||\n                state.typeEnum === STATE_TYPES.PARALLEL){\n\n            var historyChildren = state.states.filter(function(s){\n                return s.$type === 'history';\n            }); \n\n           state.historyRef = historyChildren;\n        }\n\n        //now it's safe to fill in fake state ids\n        if(!state.id){\n            state.id = generateId(state.$type);\n            idToStateMap.set(state.id, state);\n        }\n\n        //normalize onEntry/onExit, which can be single fn or array, or array of arrays (blocks)\n        ['onEntry','onExit'].forEach(function(prop){\n          if (state[prop]) {\n            if(!Array.isArray(state[prop])){\n              state[prop] = [state[prop]];\n            }\n            if(!state[prop].every(function(handler){ return Array.isArray(handler); })){\n              state[prop] = [state[prop]];\n            }\n          }\n        });\n\n        if (state.invokes && !Array.isArray(state.invokes)) {\n            state.invokes = [state.invokes];\n            state.invokes.forEach( invoke => {\n              if (invoke.finalize && !Array.isArray(invoke.finalize)) {\n                invoke.finalize = [invoke.finalize];\n              }\n            })\n        }\n    }\n\n    //TODO: convert events to regular expressions in advance\n\n    function checkInitialRef(state){\n      if(!state.initialRef) throw new Error('Unable to locate initial state for composite state: ' + state.id);\n    }\n    function connectIntialAttributes(){\n      for (var j = 0, len = statesWithInitialAttributes.length; j < len; j++) {\n        var s = statesWithInitialAttributes[j];\n\n        var initialStates = Array.isArray(s.initial) ? s.initial : [s.initial];\n        s.initialRef = initialStates.map(function(initialState){ return idToStateMap.get(initialState); });\n        checkInitialRef(s);\n      }\n    }\n\n    var RX_WHITESPACE = /\\s+/;\n\n    function connectTransitionGraph(){\n        //normalize as with onEntry/onExit\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if (t.onTransition && !Array.isArray(t.onTransition)) {\n                t.onTransition = [t.onTransition];\n            }\n\n            //normalize \"event\" attribute into \"events\" attribute\n            if (typeof t.event === 'string') {\n                t.events = t.event.trim().split(RX_WHITESPACE);\n            }\n            delete t.event;\n\n            if(t.targets || (typeof t.target === 'undefined')) {\n                //targets have already been set up\n                continue;\n            }   \n\n            if(typeof t.target === 'string'){\n                var target = idToStateMap.get(t.target);\n                if(!target) throw new Error('Unable to find target state with id ' + t.target);\n                t.target = target;\n                t.targets = [t.target];\n            }else if(Array.isArray(t.target)){\n                t.targets = t.target.map(function(target){\n                    if(typeof target === 'string'){\n                        target = idToStateMap.get(target);\n                        if(!target) throw new Error('Unable to find target state with id ' + t.target);\n                        return target;\n                    }else{\n                        return target;\n                    } \n                }); \n            }else if(typeof t.target === 'object'){\n                t.targets = [t.target];\n            }else{\n                throw new Error('Transition target has unknown type: ' + t.target);\n            }\n        }\n\n        //hook up LCA - optimization\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if(t.targets) t.lcca = getLCCA(t.source,t.targets[0]);    //FIXME: we technically do not need to hang onto the lcca. only the scope is used by the algorithm\n\n            t.scope = getScope(t);\n        }\n    }\n\n    function getScope(transition){\n        //Transition scope is normally the least common compound ancestor (lcca).\n        //Internal transitions have a scope equal to the source state.\n        var transitionIsReallyInternal = \n                transition.type === 'internal' &&\n                  transition.source.typeEnum === STATE_TYPES.COMPOSITE &&   //is transition source a composite state\n                  transition.source.parent &&    //root state won't have parent\n                  transition.targets && //does it target its descendants\n                  transition.targets.every(\n                      function(target){ return transition.source.descendants.indexOf(target) > -1;});\n\n        if(!transition.targets){\n            return null;\n        }else if(transitionIsReallyInternal){\n            return transition.source; \n        }else{\n            return transition.lcca;\n        }\n    }\n\n    function getLCCA(s1, s2) {\n        var commonAncestors = [];\n        for (var j = 0, len = s1.ancestors.length; j < len; j++) {\n            var anc = s1.ancestors[j];\n            if(\n                (\n                  opts && opts.legacySemantics ? \n                    anc.typeEnum === STATE_TYPES.COMPOSITE :\n                    (anc.typeEnum === STATE_TYPES.COMPOSITE || anc.typeEnum === STATE_TYPES.PARALLEL) \n                ) &&\n                anc.descendants.indexOf(s2) > -1){\n\n                commonAncestors.push(anc);\n            }\n        };\n        if(!commonAncestors.length) throw new Error(\"Could not find LCA for states.\");\n        return commonAncestors[0];\n    }\n\n    //main execution starts here\n    //FIXME: only wrap in root state if it's not a compound state\n    populateStateIdMap(rootState);\n    var fakeRootState = wrapInFakeRootState(rootState);  //I wish we had pointer semantics and could make this a C-style \"out argument\". Instead we return him\n    traverse([],fakeRootState);\n    connectTransitionGraph();\n    connectIntialAttributes();\n\n    return fakeRootState;\n}\n\n\nfunction isEventPrefixMatch(prefix, fullName) {\n    prefix = prefix.replace(RX_TRAILING_WILDCARD, '');\n\n    if (prefix === fullName) {\n        return true;\n    }\n\n    if (prefix.length > fullName.length) {\n        return false;\n    }\n\n    if (fullName.charAt(prefix.length) !== '.') {\n        return false;\n    }\n\n    return (fullName.indexOf(prefix) === 0);\n}\n\nfunction isTransitionMatch(t, eventName) {\n    return t.events.some((tEvent) => {\n        return tEvent === '*' || isEventPrefixMatch(tEvent, eventName);\n    });\n}\n\nfunction scxmlPrefixTransitionSelector(t, event, evaluator, selectEventlessTransitions) {\n    return ( \n      selectEventlessTransitions ? \n        !t.events :\n        (t.events && event && event.name && isTransitionMatch(t, event.name))\n      )\n      && (!t.cond || evaluator(t.cond));\n}\n\nfunction eventlessTransitionSelector(state){\n  return state.transitions.filter(function(transition){ return !transition.events || ( transition.events && transition.events.length === 0 ); });\n}\n\n//priority comparison functions\nfunction getTransitionWithHigherSourceChildPriority(_args) {\n    let t1 = _args[0], t2 = _args[1];\n    var r = getStateWithHigherSourceChildPriority(t1.source, t2.source);\n    //compare transitions based first on depth, then based on document order\n    if (t1.source.depth < t2.source.depth) {\n        return t2;\n    } else if (t2.source.depth < t1.source.depth) {\n        return t1;\n    } else {\n       if (t1.documentOrder < t2.documentOrder) {\n            return t1;\n        } else {\n            return t2;\n        }\n    }\n}\n\nfunction sortInEntryOrder(s1, s2){\n  return getStateWithHigherSourceChildPriority(s1, s2) * -1\n}\n\nfunction getStateWithHigherSourceChildPriority(s1, s2) {\n    //compare states based first on depth, then based on document order\n    if (s1.depth > s2.depth) {\n        return -1;\n    } else if (s1.depth < s2.depth) {\n        return 1;\n    } else {\n        //Equality\n        if (s1.documentOrder < s2.documentOrder) {\n            return 1;\n        } else if (s1.documentOrder > s2.documentOrder) {\n            return -1;\n        } else{\n            return 0;\n        }\n    }\n}\n\nfunction initializeModelGeneratorFn(modelFn, opts, interpreter){\n    return modelFn.call(interpreter,\n        opts._x,\n        opts._x._sessionid,\n        opts._x._ioprocessors,\n        interpreter.isIn.bind(interpreter));\n}\n\nfunction deserializeSerializedConfiguration(serializedConfiguration,idToStateMap){\n  return serializedConfiguration.map(function(id){\n    var state = idToStateMap.get(id);\n    if(!state) throw new Error('Error loading serialized configuration. Unable to locate state with id ' + id);\n    return state;\n  });\n}\n\nfunction deserializeHistory(serializedHistory,idToStateMap){\n  var o = {};\n  Object.keys(serializedHistory).forEach(function(sid){\n    o[sid] = serializedHistory[sid].map(function(id){\n      var state = idToStateMap.get(id);\n      if(!state) throw new Error('Error loading serialized history. Unable to locate state with id ' + id);\n      return state;\n    });\n  });\n  return o;\n}\n\n","const constants = require('./constants');\n\n//model accessor functions\nconst query = {\n    isDescendant : function(s1, s2){\n      //Returns 'true' if state1 is a descendant of state2 (a child, or a child of a child, or a child of a child of a child, etc.) Otherwise returns 'false'.\n      return s2.descendants.indexOf(s1) > -1;\n    },\n    getAncestors: function(s, root) {\n        var ancestors, index, state;\n        index = s.ancestors.indexOf(root);\n        if (index > -1) {\n            return s.ancestors.slice(0, index);\n        } else {\n            return s.ancestors;\n        }\n    },\n    isOrthogonalTo: function(s1, s2) {\n        //Two control states are orthogonal if they are not ancestrally\n        //related, and their smallest, mutual parent is a Concurrent-state.\n        return !this.isAncestrallyRelatedTo(s1, s2) && this.getLCA(s1, s2).typeEnum === constants.STATE_TYPES.PARALLEL;\n    },\n    isAncestrallyRelatedTo: function(s1, s2) {\n        //Two control states are ancestrally related if one is child/grandchild of another.\n        return this.getAncestorsOrSelf(s2).indexOf(s1) > -1 || this.getAncestorsOrSelf(s1).indexOf(s2) > -1;\n    },\n    getAncestorsOrSelf: function(s, root) {\n        return [s].concat(query.getAncestors(s, root));\n    },\n    getDescendantsOrSelf: function(s) {\n        return [s].concat(s.descendants);\n    },\n    getLCA: function(s1, s2) {\n        var commonAncestors = this.getAncestors(s1).filter(function(a){\n            return a.descendants.indexOf(s2) > -1;\n        },this);\n        return commonAncestors[0];\n    }\n};\n\nmodule.exports = query;\n"],"sourceRoot":""}