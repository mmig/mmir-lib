{"version":3,"sources":["webpack://scionCoreLib/webpack/universalModuleDefinition","webpack://scionCoreLib/webpack/bootstrap","webpack://scionCoreLib/./node_modules/process/browser.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/constants.js","webpack://scionCoreLib/./node_modules/timers-browserify/main.js","webpack://scionCoreLib/(webpack)/buildin/global.js","webpack://scionCoreLib/./index.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core/lib/Statechart.js","webpack://scionCoreLib/./node_modules/setimmediate/setImmediate.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/scion-core-base.js","webpack://scionCoreLib/./node_modules/tiny-events/lib/index.js","webpack://scionCoreLib/./node_modules/util/util.js","webpack://scionCoreLib/./node_modules/util/support/isBufferBrowser.js","webpack://scionCoreLib/./node_modules/inherits/inherits_browser.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/ArraySet.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/helpers.js","webpack://scionCoreLib/./node_modules/@scion-scxml/core-base/lib/query.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","setTimeout","e","this","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","length","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","args","Array","arguments","push","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","STATE_TYPES","BASIC","COMPOSITE","PARALLEL","HISTORY","INITIAL","FINAL","SCXML_IOPROCESSOR_TYPE","HTTP_IOPROCESSOR_TYPE","RX_TRAILING_WILDCARD","global","scope","self","Function","Timeout","id","clearFn","_id","_clearFn","setInterval","clearInterval","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","require","setImmediate","clearImmediate","g","_typeof","base","query","helpers","transitionComparator","Statechart","modelOrModelFactory","opts","_classCallCheck","legacySemantics","_possibleConstructorReturn","_getPrototypeOf","BaseInterpreter","currentEvent","selectEventlessTransitions","transitionSelector","enabledTransitions","Set","_evaluateAction","atomicStates","_configuration","iter","sort","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","iterator","next","done","state","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","loop","_step2","_iterator2","getAncestors","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","transitions","add","err","return","priorityEnabledTransitions","_removeConflictingTransition","_log","_this","filteredTransitions","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","t1","t1Preempted","transitionsToRemove","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_loop","t2","t1ExitSet","_computeExitSet","t2ExitSet","hasIntersection","_toConsumableArray","some","has","source","map","descendants","indexOf","_iterator5","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","t3","remove","InterpreterScriptingContext","invokers","http://www.w3.org/TR/scxml/","invokingSession","invokeObj","invokerExecutionContext","cb","constructorFunction","interpreter","fnModel","options","invokeid","params","parentSession","docUrl","model","start","registerImmediate","html","channel","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","document","attachTo","getPrototypeOf","toString","handle","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","event","data","port2","createElement","documentElement","script","onreadystatechange","removeChild","appendChild","Math","random","slice","addEventListener","attachEvent","callback","task","EventEmitter","util","ArraySet","constants","extend","transitionWithTargets","initializeModel","scxmlPrefixTransitionSelector","isEventPrefixMatch","isTransitionMatch","getTransitionWithHigherSourceChildPriority","eventlessTransitionSelector","sortInEntryOrder","getStateWithHigherSourceChildPriority","initializeModelGeneratorFn","deserializeSerializedConfiguration","deserializeHistory","printTrace","DEBUG","_isStepping","_scriptingContext","interpreterScriptingContext","_assertThisInitialized","generateSessionid","sessionid","sessionRegistry","_executionContext","_ioprocessors","location","scxml","_x","_sessionid","JSON","parse","stringify","_model","console","log","priorityComparisonFn","set","String","join","_externalEventQueue","_internalEventQueue","$deserializeDatamodel","snapshot","$idToStateMap","_historyValue","_isInFinalState","EVENTS","forEach","_exitInterpreter","_this2","_cancelAllDelayedSends","statesToExit","_getFullConfiguration","j","stateExited","onExit","exitIdx","exitLen","block","blockIdx","blockLen","actionRef","_handleError","invokes","invoke","cancelInvoke","$type","parent","send","target","donedata","delete","_initStart","_performBigStep","getConfiguration","genAsync","_this3","nop","initialRef","reduce","a","b","stateName","getFullConfiguration","keepGoing","allStatesExited","allStatesEntered","_this$_startBigStep2","_slicedToArray","_startBigStep","_this$_selectTransiti2","_selectTransitionsAndPerformSmallStep","_finishBigStep","selectedTransitions","_selectTransitions","isEmpty","ev","shift","statesExited","statesEntered","_this$_performSmallSt2","_performSmallStep","_this4","autoforward","finalize","action","_this5","from","filter","f","every","typeEnum","_timeouts","timeoutOptions","sendOptions","delay","timeoutHandle","keys","_timeoutMap","_this$_startBigStep4","nextStep","_this$_selectTransiti4","selectedTransitionsWithTargets","_exitStates","_executeTransitions","_enterStates","_this$_getStatesExite2","_getStatesExited","isAtomic","historyRef","isDeep","s0","basicStatesExited","transitionList","txIdx","txLen","desc","configList","cfgIdx","cfgLen","ancestors","ancIdx","ancLen","sortedTransitions","stxIdx","transition","targetIds","targets","onTransition","_this6","statesForDefaultEntry","defaultHistoryContent","_computeEntrySet","enterIdx","enterLen","stateEntered","onEntry","entryIdx","entryLen","initialState","grandparent","states","isInFinalState","_getEffectiveTargetStates","statesToEnter","_addDescendantStatesToEnter","ancestor","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","_addAncestorStatesToEnter","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","isDescendant","_this7","traverse","anc","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","child","_iterator10","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_step11","_iterator11","_this8","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_step12","_iterator12","_iteratorNormalCompletion13","_didIteratorError13","_iteratorError13","_step13","_iterator13","_iteratorNormalCompletion14","_didIteratorError14","_iteratorError14","_step14","_iterator14","_iteratorNormalCompletion15","_didIteratorError15","_iteratorError15","_step15","_iterator15","_iteratorNormalCompletion16","_didIteratorError16","_iteratorError16","_step16","_iterator16","_iteratorNormalCompletion18","_didIteratorError18","_iteratorError18","_step18","_iterator18","targetState","_iteratorNormalCompletion17","_didIteratorError17","_iteratorError17","_step17","_iterator17","_iteratorNormalCompletion19","_didIteratorError19","_iteratorError19","_step19","_iterator19","_iteratorNormalCompletion20","_didIteratorError20","_iteratorError20","_step20","_loop2","_iterator20","_this9","contains","__proto__","match","tagname","line","column","reason","message","type","arg","inspect","listener","events","getEvents","stateIdx","stateLen","_serializeHistory","$serializeDatamodel","sid","evtObjOrName","optionalData","_performBigStepAsync","config","sessionIdCounter","Map","_interpreter","_invokeMap","validateUriRegex","invokeSendTargetRegex","scxmlSendTargetRegex","_installDefaultPropsOnEvent","xmlString","xmlParser","_this10","Promise","resolve","reject","session","_this11","sessionPromise","then","cancel","isInternal","origin","origintype","prop","sendFn","sendType","customSend","_this12","raise","sendid","doSend","targetSessionId","invokeId","sendAsync","sendAction","test","customCancel","_listeners","isArray","__once","index","splice","getOwnPropertyDescriptors","obj","descriptors","getOwnPropertyDescriptor","formatRegExp","format","isString","objects","str","replace","x","Number","_","isNull","isObject","deprecate","fn","msg","noDeprecation","warned","throwDeprecation","traceDeprecation","trace","error","debugEnviron","debugs","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","isUndefined","customInspect","stylizeWithColor","formatValue","styleType","style","styles","recurseTimes","isFunction","constructor","ret","primitive","simple","isNumber","formatPrimitive","visibleKeys","hash","val","idx","arrayToHash","getOwnPropertyNames","isError","formatError","isRegExp","RegExp","isDate","Date","output","braces","toUTCString","formatProperty","formatArray","pop","prev","cur","numLinesEst","reduceToSingleString","split","substr","ar","re","objectToString","pad","debuglog","NODE_DEBUG","toUpperCase","pid","bold","italic","underline","inverse","white","grey","black","blue","cyan","green","magenta","red","yellow","special","number","boolean","null","string","date","regexp","isNullOrUndefined","isSymbol","isPrimitive","isBuffer","months","time","getHours","getMinutes","getSeconds","getDate","getMonth","inherits","kCustomPromisifiedSymbol","callbackifyOnRejected","newReason","promisify","original","TypeError","writable","configurable","promiseResolve","promiseReject","promise","setPrototypeOf","defineProperties","custom","callbackify","callbackified","maybeCb","rej","copy","fill","readUInt8","ctor","superCtor","super_","TempCtor","union","v","difference","size","equals","s2","prefix","fullName","charAt","eventName","tEvent","s1","documentOrder","to","k","rootState","idToStateMap","idCount","statesWithInitialAttributes","transitionToString","sourceState","cond","stateToString","checkInitialRef","RX_WHITESPACE","getScope","transitionIsReallyInternal","lcca","getLCCA","commonAncestors","populateStateIdMap","fakeRootState","ancs","initialChildren","initial","historyChildren","count","generateId","handler","trim","connectTransitionGraph","initialStates","connectIntialAttributes","evaluator","_args","modelFn","isIn","serializedConfiguration","serializedHistory","isOrthogonalTo","isAncestrallyRelatedTo","getLCA","getAncestorsOrSelf","getDescendantsOrSelf"],"mappings":"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","file":"scion-core-lib.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"scionCoreLib\"] = factory();\n\telse\n\t\troot[\"scionCoreLib\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var STATE_TYPES = {\n    BASIC: 0,\n    COMPOSITE: 1,\n    PARALLEL: 2,\n    HISTORY: 3,\n    INITIAL: 4,\n    FINAL: 5\n};\n\nconst SCXML_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#SCXMLEventProcessor'\nconst HTTP_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor'\nconst RX_TRAILING_WILDCARD = /\\.\\*$/;\n\nmodule.exports = {\n  STATE_TYPES : STATE_TYPES,\n  SCXML_IOPROCESSOR_TYPE  : SCXML_IOPROCESSOR_TYPE,\n  HTTP_IOPROCESSOR_TYPE  : HTTP_IOPROCESSOR_TYPE, \n  RX_TRAILING_WILDCARD  : RX_TRAILING_WILDCARD \n};\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\r\nmodule.exports = require('@scion-scxml/core');\r\n","const base = require('@scion-scxml/core-base'),\n      helpers = base.helpers,\n      query = base.query,\n      transitionComparator = base.helpers.transitionComparator;\n\n/** \n * @description Implements semantics described in Algorithm D of the SCXML specification. \n * See {@link scion.BaseInterpreter} for information on the constructor arguments.\n * @class SCInterpreter \n * @extends BaseInterpreter\n */\nclass Statechart extends base.BaseInterpreter {\n\n  constructor(modelOrModelFactory, opts){\n\n    opts = opts || {};\n    opts.legacySemantics = false;\n\n    super(modelOrModelFactory, opts);\n  }\n\n  /** @private */\n  _selectTransitions(currentEvent, selectEventlessTransitions) {\n    var transitionSelector = this.opts.transitionSelector;\n    var enabledTransitions = new this.opts.Set();\n\n    var e = this._evaluateAction.bind(this,currentEvent);\n\n    let atomicStates = this._configuration.iter().sort(transitionComparator);\n    for(let state of atomicStates){\nloop: for(let s of [state].concat(query.getAncestors(state))){\n        for(let t of s.transitions){\n          if(transitionSelector(t, currentEvent, e, selectEventlessTransitions)){\n            enabledTransitions.add(t);\n            break loop;\n          }\n        }\n      }\n    }\n\n    var priorityEnabledTransitions = this._removeConflictingTransition(enabledTransitions);\n\n    this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n\n    return priorityEnabledTransitions;\n  }\n\n  /** @private */\n  _removeConflictingTransition(enabledTransitions) {\n    let filteredTransitions = new this.opts.Set()\n    //toList sorts the transitions in the order of the states that selected them\n    for( let t1 of enabledTransitions.iter()){\n      let t1Preempted = false;\n      let transitionsToRemove = new Set()\n      for (let t2 of filteredTransitions.iter()){\n        //TODO: can we compute this statically? for example, by checking if the transition scopes are arena orthogonal?\n        let t1ExitSet = this._computeExitSet([t1]);\n        let t2ExitSet = this._computeExitSet([t2]);\n        let hasIntersection = [...t1ExitSet].some( s => t2ExitSet.has(s) )  || [...t2ExitSet].some( s => t1ExitSet.has(s));\n        this._log('t1ExitSet',t1.source.id,[...t1ExitSet].map( s => s.id ))\n          this._log('t2ExitSet',t2.source.id,[...t2ExitSet].map( s => s.id ))\n          this._log('hasIntersection',hasIntersection)\n          if(hasIntersection){\n            if(t2.source.descendants.indexOf(t1.source) > -1){    //is this the same as being ancestrally related?\n              transitionsToRemove.add(t2)\n            }else{ \n              t1Preempted = true;\n              break\n            }\n          }\n      }\n      if(!t1Preempted){\n        for(let t3 of transitionsToRemove){\n          filteredTransitions.remove(t3)\n        }\n        filteredTransitions.add(t1)\n      }\n    }\n\n    return filteredTransitions;\n  }\n}\n\nbase.Statechart = Statechart;\n//simple default invoker\nbase.InterpreterScriptingContext.invokers = {\n  \"http://www.w3.org/TR/scxml/\" : function(invokingSession, invokeObj, invokerExecutionContext, cb){\n    //put invoke logic here: \n    let method, arg;\n    if(invokeObj.constructorFunction){\n      const fnModel = invokeObj.constructorFunction;\n      const options = {\n        invokeid : invokeObj.id,\n        params : invokeObj.params,\n        parentSession : invokingSession,\n        docUrl : invokeObj.docUrl\n        //sessionid : //TODO: construct or generate a sessionid for invoked session\n      };\n      const model = invokerExecutionContext;\n      let interpreter;\n      if( options.parentSession instanceof Statechart ){\n        interpreter = new Statechart(fnModel, options);\n      } \n      cb(null, interpreter, fnModel, model);\n      //we introduce a delay here before starting the interpreter to give clients that are subscribed to onInvokedSessionInitialized event a chance to subscribe to events on the newly instantiated interpreter\n      setImmediate( () => interpreter.start() );    \n    } else{\n      throw new Error('Invoke object needs a constructorFunction property' );\n    }\n  }\n};\nbase.InterpreterScriptingContext.invokers[undefined] = \n  base.InterpreterScriptingContext.invokers[null] = \n  base.InterpreterScriptingContext.invokers['scxml'] = \n  base.InterpreterScriptingContext.invokers[\"http://www.w3.org/TR/scxml/\"];\n\nmodule.exports = base;\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","//   Copyright 2012-2012 Jacob Beard, INFICON, and other SCION contributors\n//\n//   Licensed under the Apache License, Version 2.0 (the \"License\");\n//   you may not use this file except in compliance with the License.\n//   You may obtain a copy of the License at\n//\n//       http://www.apache.org/licenses/LICENSE-2.0\n//\n//   Unless required by applicable law or agreed to in writing, software\n//   distributed under the License is distributed on an \"AS IS\" BASIS,\n//   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n//   See the License for the specific language governing permissions and\n//   limitations under the License.\n\n/**\n * SCION-CORE global object\n * @namespace scion\n */\n\n/**\n * An Array of strings representing the ids all of the basic states the\n * interpreter is in after a big-step completes.\n * @typedef {Array<string>} Configuration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n\"use strict\";\n\nconst EventEmitter = require('tiny-events').EventEmitter,\n  util = require('util'),\n  ArraySet = require('./ArraySet'),\n  constants = require('./constants'),\n  helpers = require('./helpers'),\n  query = require('./query'),\n  extend = helpers.extend,\n  transitionWithTargets = helpers.transitionWithTargets,\n  transitionComparator = helpers.transitionComparator,\n  initializeModel = helpers.initializeModel,\n  isEventPrefixMatch = helpers.isEventPrefixMatch,\n  isTransitionMatch = helpers.isTransitionMatch,\n  scxmlPrefixTransitionSelector = helpers.scxmlPrefixTransitionSelector,\n  eventlessTransitionSelector = helpers.eventlessTransitionSelector,\n  getTransitionWithHigherSourceChildPriority = helpers.getTransitionWithHigherSourceChildPriority,\n  sortInEntryOrder = helpers.sortInEntryOrder,\n  getStateWithHigherSourceChildPriority = helpers.getStateWithHigherSourceChildPriority,\n  initializeModelGeneratorFn = helpers.initializeModelGeneratorFn,\n  deserializeSerializedConfiguration = helpers.deserializeSerializedConfiguration,\n  deserializeHistory = helpers.deserializeHistory,\n  BASIC = constants.STATE_TYPES.BASIC,\n  COMPOSITE = constants.STATE_TYPES.COMPOSITE,\n  PARALLEL = constants.STATE_TYPES.PARALLEL,\n  HISTORY = constants.STATE_TYPES.HISTORY,\n  INITIAL = constants.STATE_TYPES.INITIAL,\n  FINAL = constants.STATE_TYPES.FINAL,\n  SCXML_IOPROCESSOR_TYPE  = constants.SCXML_IOPROCESSOR_TYPE;\n\nconst printTrace = typeof process !== 'undefined' && !!process.env.DEBUG;\n\n\n/**\n * @interface EventEmitter\n */\n\n/**\n* @event scion.BaseInterpreter#onError\n* @property {string} tagname The name of the element that produced the error. \n* @property {number} line The line in the source file in which the error occurred.\n* @property {number} column The column in the source file in which the error occurred.\n* @property {string} reason An informative error message. The text is platform-specific and subject to change.\n*/\n\n\n/**\n * @function\n * @name EventEmitter.prototype#on\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#once\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#off\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#emit\n * @param {string} type\n * @param {any} args\n */\n/** \n * @description The SCXML constructor creates an interpreter instance from a model object.\n * @abstract\n * @class BaseInterpreter\n * @memberof scion\n * @extends EventEmitter\n * @param {SCJSON | scxml.ModelFactory} modelOrModelFactory Either an SCJSON root state; or an scxml.ModelFactory, which is a function which returns an SCJSON object. \n * @param opts\n * @param {string} [opts.sessionid] Used to populate SCXML _sessionid.\n * @param {function} [opts.generateSessionid] Factory used to generate sessionid if sessionid keyword is not specified\n * @param {Map<string, BaseInterpreter>} [opts.sessionRegistry] Map used to map sessionid strings to Statechart instances.\n * @param [opts.Set] Class to use as an ArraySet. Defaults to ES6 Set.\n * @param {object} [opts.params]  Used to pass params from invoke. Sets the datamodel when interpreter is instantiated.\n * @param {Snapshot} [opts.snapshot] State machine snapshot. Used to restore a serialized state machine.\n * @param {Statechart} [opts.parentSession]  Used to pass parent session during invoke.\n * @param {string }[opts.invokeid]  Support for id of invoke element at runtime.\n * @param {boolean} [opts.legacySemantics]\n * @param [opts.console]\n * @param [opts.transitionSelector]\n * @param [opts.customCancel]\n * @param [opts.customSend]\n * @param [opts.sendAsync]\n * @param [opts.doSend]\n * @param [opts.invokers]\n * @param [opts.xmlParser]\n * @param [opts.interpreterScriptingContext]\n * @param [opts.invokerExecutionContext]\n */\nclass BaseInterpreter extends EventEmitter {\n\n  constructor(modelOrModelFactory, opts){\n\n    super();\n\n    this.opts = opts;\n\n    this.opts.InterpreterScriptingContext = this.opts.InterpreterScriptingContext || InterpreterScriptingContext;\n\n    this._isStepping = false;\n\n    this._scriptingContext = this.opts.interpreterScriptingContext || (this.opts.InterpreterScriptingContext ? new this.opts.InterpreterScriptingContext(this) : {}); \n\n    this.opts.generateSessionid = this.opts.generateSessionid || BaseInterpreter.generateSessionid;\n    this.opts.sessionid = this.opts.sessionid || this.opts.generateSessionid();\n    this.opts.sessionRegistry = this.opts.sessionRegistry || BaseInterpreter.sessionRegistry;  //TODO: define a better interface. For now, assume a Map<sessionid, session>\n    this.opts.invokerExecutionContext = opts.invokerExecutionContext ||  modelOrModelFactory._executionContext;\n\n\n    let _ioprocessors = {};\n    _ioprocessors[SCXML_IOPROCESSOR_TYPE] = {\n      location : `#_scxml_${this.opts.sessionid}`\n    }\n    _ioprocessors.scxml = _ioprocessors[SCXML_IOPROCESSOR_TYPE];    //alias\n\n    //SCXML system variables:\n    this.opts._x = {\n        _sessionid : this.opts.sessionid,\n        _ioprocessors : _ioprocessors\n    };\n\n\n    var model;\n    if(typeof modelOrModelFactory === 'function'){\n        model = initializeModelGeneratorFn(modelOrModelFactory, this.opts, this);\n    }else if(typeof modelOrModelFactory === 'object'){\n        model = JSON.parse(JSON.stringify(modelOrModelFactory)); //assume object\n    }else{\n        throw new Error('Unexpected model type. Expected model factory function, or scjson object.');\n    }\n\n    this._model = initializeModel(model, this.opts);\n\n    this.opts.console = this.opts.console || (typeof console === 'undefined' ? {log : function(){}} : console);   //rely on global console if this console is undefined\n    this.opts.Set = this.opts.Set || ArraySet;\n    this.opts.priorityComparisonFn = this.opts.priorityComparisonFn || getTransitionWithHigherSourceChildPriority;\n    this.opts.transitionSelector = this.opts.transitionSelector || scxmlPrefixTransitionSelector;\n\n    this.opts.sessionRegistry.set(String(this.opts.sessionid), this);\n\n    this._scriptingContext.log = this._scriptingContext.log || (function log(){ \n      if(this.opts.console.log.apply){\n        this.opts.console.log.apply(this.opts.console, arguments); \n      } else {\n        //console.log on older IE does not support Function.apply, so just pass him the first argument. Best we can do for now.\n        this.opts.console.log(Array.prototype.slice.apply(arguments).join(',')); \n      }\n    }.bind(this));   //set up default scripting context log function\n\n    this._externalEventQueue = [];\n    this._internalEventQueue = [];\n\n    if(this.opts.params){\n      this._model.$deserializeDatamodel(this.opts.params);   //load up the datamodel\n    }\n\n    //check if we're loading from a previous snapshot\n    if(this.opts.snapshot){\n      this._configuration = new this.opts.Set(deserializeSerializedConfiguration(this.opts.snapshot[0], this._model.$idToStateMap));\n      this._historyValue = deserializeHistory(this.opts.snapshot[1], this._model.$idToStateMap); \n      this._isInFinalState = this.opts.snapshot[2];\n      this._model.$deserializeDatamodel(this.opts.snapshot[3]);   //load up the datamodel\n      this._internalEventQueue = this.opts.snapshot[4];\n    }else{\n      this._configuration = new this.opts.Set();\n      this._historyValue = {};\n      this._isInFinalState = false;\n    }\n\n    //add debug logging\n    BaseInterpreter.EVENTS.forEach(function(event){\n      this.on(event, this._log.bind(this,event));\n    }, this);\n\n    module.exports.emit('new',this);\n  }\n\n  /** \n  * Cancels the session. This clears all timers; puts the interpreter in a\n  * final state; and runs all exit actions on current states.\n  * @memberof BaseInterpreter.prototype\n  */\n  cancel(){\n    delete this.opts.parentSession;\n    if(this._isInFinalState) return;\n    this._isInFinalState = true;\n    this._log(`session cancelled ${this.opts.invokeid}`);\n    this._exitInterpreter(null);\n  }\n\n  _exitInterpreter(event){\n    //TODO: cancel invoked sessions\n    //cancel all delayed sends when we enter into a final state.\n    this._cancelAllDelayedSends();\n\n    let statesToExit = this._getFullConfiguration().sort(getStateWithHigherSourceChildPriority);\n\n    for (var j = 0, len = statesToExit.length; j < len; j++) {\n        var stateExited = statesToExit[j];\n\n        if(stateExited.onExit !== undefined) {\n            for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n                let block = stateExited.onExit[exitIdx];\n                for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                    let actionRef = block[blockIdx];\n                    try {\n                      actionRef.call(this._scriptingContext, null);\n                    } catch (e){\n                      this._handleError(e, actionRef);\n                      break;\n                    }\n                }\n            }\n        }\n\n        //cancel invoked session\n        if(stateExited.invokes) stateExited.invokes.forEach( invoke => {\n          this._scriptingContext.cancelInvoke(invoke.id);\n        })\n\n        //if he is a top-level <final> state, then return the done event\n        if( stateExited.$type === 'final' &&\n            stateExited.parent.$type === 'scxml'){\n\n          if(this.opts.parentSession){\n            this._scriptingContext.send({\n              target: '#_parent', \n              name: 'done.invoke.' + this.opts.invokeid,\n              data : stateExited.donedata && stateExited.donedata.call(this._scriptingContext, event)\n            });\n          }\n\n          this.opts.sessionRegistry.delete(this.opts.sessionid);\n          this.emit('onExitInterpreter', event);\n        }\n    }\n\n  }\n\n  /** \n   * Starts the interpreter. Should only be called once, and should be called\n   * before BaseInterpreter.prototype#gen is called for the first time.  Returns a\n   * Configuration.\n   * @return {Configuration}\n   * @memberof BaseInterpreter.prototype\n   * @emits scion.BaseInterpreter#onEntry\n   * @emits scion.BaseInterpreter#onExit\n   * @emits scion.BaseInterpreter#onTransition\n   * @emits scion.BaseInterpreter#onDefaultEntry\n   * @emits scion.BaseInterpreter#onError\n   * @emits scion.BaseInterpreter#onBigStepBegin\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onBigStepSuspend\n   * @emits scion.BaseInterpreter#onBigStepResume\n   * @emits scion.BaseInterpreter#onSmallStepBegin\n   * @emits scion.BaseInterpreter#onSmallStepEnd\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onExitInterpreter\n   */\n  start() {\n      this._initStart();\n      this._performBigStep();\n      return this.getConfiguration();\n  }\n\n\n  /**\n   * This callback is displayed as a global member.\n   * @callback genCallback\n   * @param {Error} err\n   * @param {Configuration} configuration\n   */\n\n  /**\n   * Starts the interpreter asynchronously\n   * @param  {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n   * @memberof BaseInterpreter.prototype \n   * @emits scion.BaseInterpreter#onEntry\n   * @emits scion.BaseInterpreter#onExit\n   * @emits scion.BaseInterpreter#onTransition\n   * @emits scion.BaseInterpreter#onDefaultEntry\n   * @emits scion.BaseInterpreter#onError\n   * @emits scion.BaseInterpreter#onBigStepBegin\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onBigStepSuspend\n   * @emits scion.BaseInterpreter#onBigStepResume\n   * @emits scion.BaseInterpreter#onSmallStepBegin\n   * @emits scion.BaseInterpreter#onSmallStepEnd\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onExitInterpreter\n   */\n  startAsync(cb) {\n      cb = this._initStart(cb);\n      this.genAsync(null, cb);\n  }\n\n  _initStart(cb){\n      if (typeof cb !== 'function') {\n          cb = nop;\n      }\n\n      this._log(\"performing initial big step\");\n\n      //We effectively need to figure out states to enter here to populate initial config. assuming root is compound state makes this simple.\n      //but if we want it to be parallel, then this becomes more complex. so when initializing the model, we add a 'fake' root state, which\n      //makes the following operation safe.\n      this._model.initialRef.forEach( s => this._configuration.add(s) );\n\n      return cb;\n  }\n\n  /** \n  * Returns state machine {@link Configuration}.\n  * @return {Configuration}\n  * @memberof BaseInterpreter.prototype \n  */\n  getConfiguration() {\n      return this._configuration.iter().map(function(s){return s.id;});\n  }\n\n  _getFullConfiguration(){\n      return this._configuration.iter().\n              map(function(s){ return [s].concat(query.getAncestors(s));},this).\n              reduce(function(a,b){return a.concat(b);},[]).    //flatten\n              reduce(function(a,b){return a.indexOf(b) > -1 ? a : a.concat(b);},[]); //uniq\n  }\n\n\n  /** \n  * @return {FullConfiguration}\n  * @memberof BaseInterpreter.prototype \n  */\n  getFullConfiguration() {\n      return this._getFullConfiguration().map(function(s){return s.id;});\n  }\n\n\n  /** \n  * @return {boolean}\n  * @memberof BaseInterpreter.prototype \n  * @param {string} stateName\n  */\n  isIn(stateName) {\n      return this.getFullConfiguration().indexOf(stateName) > -1;\n  }\n\n  /** \n  * Is the state machine in a final state?\n  * @return {boolean}\n  * @memberof BaseInterpreter.prototype \n  */\n  isFinal() {\n      return this._isInFinalState;\n  }\n\n  /** @private */\n  _performBigStep(e) {\n      let currentEvent, keepGoing, allStatesExited, allStatesEntered;\n      [allStatesExited, allStatesEntered, keepGoing, currentEvent] = this._startBigStep(e);\n\n      while (keepGoing) {\n        [currentEvent, keepGoing] = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n      }\n\n      this._finishBigStep(currentEvent, allStatesEntered, allStatesExited);\n  }\n\n  _selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited){\n      //first select with null event\n      var selectedTransitions  = this._selectTransitions(currentEvent, true);\n      if(selectedTransitions.isEmpty()){\n        let ev = this._internalEventQueue.shift();\n        if(ev){ \n          currentEvent = ev;\n          selectedTransitions = this._selectTransitions(currentEvent, false);\n        }\n      }\n\n      if(!selectedTransitions.isEmpty()){\n        this.emit('onSmallStepBegin', currentEvent);\n        let statesExited, statesEntered;\n        [statesExited, statesEntered] = this._performSmallStep(currentEvent, selectedTransitions);\n        if(statesExited) statesExited.forEach( s => allStatesExited.add(s) );\n        if(statesEntered) statesEntered.forEach( s => allStatesEntered.add(s) );\n        this.emit('onSmallStepEnd', currentEvent);\n      }\n      let keepGoing = !selectedTransitions.isEmpty() || this._internalEventQueue.length;\n      return [currentEvent, keepGoing];\n  }\n\n  _startBigStep(e){\n      this.emit('onBigStepBegin', e);\n\n      //do applyFinalize and autoforward\n      this._configuration.iter().forEach(state => {\n        if(state.invokes) state.invokes.forEach( invoke =>  {\n          if(invoke.autoforward){\n            //autoforward\n            this._scriptingContext.send({\n              target: `#_${invoke.id}`, \n              name: e.name,\n              data : e.data\n            });\n          }\n          if(invoke.id === e.invokeid){\n            //applyFinalize\n            if(invoke.finalize) invoke.finalize.forEach( action =>  this._evaluateAction(e, action));\n          } \n        })\n      }); \n\n      if (e) this._internalEventQueue.push(e);\n\n      let allStatesExited = new Set(), allStatesEntered = new Set();\n      let keepGoing = true;\n      let currentEvent = e;\n      return [allStatesEntered, allStatesExited, keepGoing, currentEvent];\n  }\n\n  _finishBigStep(e, allStatesEntered, allStatesExited, cb){\n      let statesToInvoke = Array.from(new Set([...allStatesEntered].filter(s => s.invokes && !allStatesExited.has(s)))).sort(sortInEntryOrder);\n\n      // Here we invoke whatever needs to be invoked. The implementation of 'invoke' is platform-specific\n      statesToInvoke.forEach( s => {\n          s.invokes.forEach( f =>  this._evaluateAction(e,f) )\n      });\n\n      // cancel invoke for allStatesExited\n      allStatesExited.forEach( s => {\n        if(s.invokes) s.invokes.forEach( invoke => {\n          this._scriptingContext.cancelInvoke(invoke.id);\n        })\n      });\n\n      // TODO: Invoking may have raised internal error events and we iterate to handle them        \n      //if not internalQueue.isEmpty():\n      //    continue\n\n      this._isInFinalState = this._configuration.iter().every(function(s){ return s.typeEnum === FINAL; });\n      if(this._isInFinalState){\n        this._exitInterpreter(e);\n      }\n      this.emit('onBigStepEnd', e);\n      if(cb) cb(undefined, this.getConfiguration());\n  }\n\n  _cancelAllDelayedSends(){\n    for( let timeoutOptions of this._scriptingContext._timeouts){\n      if(!timeoutOptions.sendOptions.delay) continue;\n      this._log('cancelling delayed send', timeoutOptions);\n      clearTimeout(timeoutOptions.timeoutHandle);\n      this._scriptingContext._timeouts.delete(timeoutOptions);\n    }\n    Object.keys(this._scriptingContext._timeoutMap).forEach(function(key){\n      delete this._scriptingContext._timeoutMap[key];\n    }, this);\n  }\n\n  _performBigStepAsync(e, cb) {\n      let currentEvent, keepGoing, allStatesExited, allStatesEntered;\n      [allStatesExited, allStatesEntered, keepGoing, currentEvent] = this._startBigStep(e);\n\n      function nextStep(emit){\n        this.emit(emit);\n        [currentEvent, keepGoing] = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n\n        if(keepGoing){\n          this.emit('onBigStepSuspend');\n          setImmediate(nextStep.bind(this,'onBigStepResume'));\n        }else{\n          this._finishBigStep(currentEvent, allStatesEntered, allStatesExited, cb);\n        }\n      }\n      nextStep.call(this,'onBigStepBegin');\n  }\n\n  /** @private */\n  _performSmallStep(currentEvent, selectedTransitions) {\n\n      this._log(\"selecting transitions with currentEvent\", currentEvent);\n\n      this._log(\"selected transitions\", selectedTransitions);\n\n      let statesExited,\n          statesEntered;\n\n      if (!selectedTransitions.isEmpty()) {\n\n          //we only want to enter and exit states from transitions with targets\n          //filter out targetless transitions here - we will only use these to execute transition actions\n          var selectedTransitionsWithTargets = new this.opts.Set(selectedTransitions.iter().filter(transitionWithTargets));\n\n          statesExited = this._exitStates(currentEvent, selectedTransitionsWithTargets)\n          this._executeTransitions(currentEvent, selectedTransitions);\n          statesEntered = this._enterStates(currentEvent, selectedTransitionsWithTargets)\n\n          this._log(\"new configuration \", this._configuration);\n      }\n\n      return [statesExited, statesEntered];\n  }\n\n  _exitStates(currentEvent, selectedTransitionsWithTargets){\n      let basicStatesExited, statesExited;\n      [basicStatesExited, statesExited] = this._getStatesExited(selectedTransitionsWithTargets); \n\n      this._log('exiting states')\n      for (var j = 0, len = statesExited.length; j < len; j++) {\n          var stateExited = statesExited[j];\n\n          if(stateExited.isAtomic) this._configuration.remove(stateExited);\n\n          this._log(\"exiting \", stateExited.id);\n\n          //invoke listeners\n          this.emit('onExit',stateExited.id)\n\n          if(stateExited.onExit !== undefined) {\n              for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n                  let block = stateExited.onExit[exitIdx];\n                  for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                      let actionRef = block[blockIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n\n          var f;\n          if (stateExited.historyRef) {\n              for(let historyRef of stateExited.historyRef){\n                  if (historyRef.isDeep) {\n                      f = function(s0) {\n                          return s0.typeEnum === BASIC && stateExited.descendants.indexOf(s0) > -1;\n                      };\n                  } else {\n                      f = function(s0) {\n                          return s0.parent === stateExited;\n                      };\n                  }\n                  //update history\n                  this._historyValue[historyRef.id] = statesExited.filter(f);\n              }\n          }\n      }\n\n      return statesExited;\n  }\n\n  /** @private */\n  _getStatesExited(transitions) {\n    var statesExited = new this.opts.Set();\n    var basicStatesExited = new this.opts.Set();\n\n    //States exited are defined to be active states that are\n    //descendants of the scope of each priority-enabled transition.\n    //Here, we iterate through the transitions, and collect states\n    //that match this condition. \n    var transitionList = transitions.iter();\n    for (var txIdx = 0, txLen = transitionList.length; txIdx < txLen; txIdx++) {\n      var transition = transitionList[txIdx];\n      var scope = transition.scope,\n          desc = scope.descendants;\n\n      //For each state in the configuration\n      //is that state a descendant of the transition scope?\n      //Store ancestors of that state up to but not including the scope.\n      var configList = this._configuration.iter();\n      for (var cfgIdx = 0, cfgLen = configList.length; cfgIdx < cfgLen; cfgIdx++) {\n        var state = configList[cfgIdx];\n        if(desc.indexOf(state) > -1){\n          basicStatesExited.add(state);\n          statesExited.add(state);\n          var ancestors = query.getAncestors(state,scope); \n          for (var ancIdx = 0, ancLen = ancestors.length; ancIdx < ancLen; ancIdx++) { \n            statesExited.add(ancestors[ancIdx]);\n          }\n        }\n      }\n    }\n\n    var sortedStatesExited = statesExited.iter().sort(getStateWithHigherSourceChildPriority);\n    return [basicStatesExited, sortedStatesExited];\n  }\n\n  _executeTransitions(currentEvent, selectedTransitions){\n      var sortedTransitions = selectedTransitions.iter().sort(transitionComparator);\n\n      this._log(\"executing transitition actions\");\n      for (var stxIdx = 0, len = sortedTransitions.length; stxIdx < len; stxIdx++) {\n          var transition = sortedTransitions[stxIdx];\n\n          var targetIds = transition.targets && transition.targets.map(function(target){return target.id;});\n\n          this.emit('onTransition',transition.source.id,targetIds, transition.source.transitions.indexOf(transition));\n\n          if(transition.onTransition !== undefined) {\n              for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                  let actionRef = transition.onTransition[txIdx];\n                  try {\n                    actionRef.call(this._scriptingContext, currentEvent);\n                  } catch (e){\n                    this._handleError(e, actionRef);\n                    break;\n                  }\n              }\n          }\n      }\n  }\n\n  _enterStates(currentEvent, selectedTransitionsWithTargets){\n      this._log(\"entering states\");\n\n      let statesEntered = new Set();\n      let statesForDefaultEntry = new Set();\n      // initialize the temporary table for default content in history states\n      let defaultHistoryContent = {};\n      this._computeEntrySet(selectedTransitionsWithTargets, statesEntered, statesForDefaultEntry, defaultHistoryContent); \n      statesEntered = Array.from(statesEntered).sort(sortInEntryOrder); \n\n      this._log(\"statesEntered \", statesEntered);\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n          var stateEntered = statesEntered[enterIdx];\n\n          if(stateEntered.isAtomic) this._configuration.add(stateEntered);\n\n          this._log(\"entering\", stateEntered.id);\n\n          this.emit('onEntry',stateEntered.id);\n\n          if(stateEntered.onEntry !== undefined) {\n              for (var entryIdx = 0, entryLen = stateEntered.onEntry.length; entryIdx < entryLen; entryIdx++) {\n                  let block = stateEntered.onEntry[entryIdx];\n                  for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                      let actionRef = block[blockIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n\n          if(statesForDefaultEntry.has(stateEntered)){\n              for(let initialState of stateEntered.initialRef){\n                  this.emit('onDefaultEntry', initialState.id);\n                  if(initialState.typeEnum === INITIAL){\n                      let transition = initialState.transitions[0]\n                      if(transition.onTransition !== undefined) {\n                          this._log('executing initial transition content for initial state of parent state',stateEntered.id);\n                          for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                              let actionRef = transition.onTransition[txIdx];\n                              try {\n                                actionRef.call(this._scriptingContext, currentEvent);\n                              } catch (e){\n                                this._handleError(e, actionRef);\n                                break;\n                              }\n                          }\n                      }\n                  }\n              }\n          }\n\n\n          if(defaultHistoryContent[stateEntered.id]){\n              let transition = defaultHistoryContent[stateEntered.id]\n              if(transition.onTransition !== undefined) {\n                  this._log('executing history transition content for history state of parent state',stateEntered.id);\n                  for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                      let actionRef = transition.onTransition[txIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n      }\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n          var stateEntered = statesEntered[enterIdx];\n          if(stateEntered.typeEnum === FINAL){\n            let parent = stateEntered.parent;\n            let grandparent = parent.parent;\n            this._internalEventQueue.push({name : \"done.state.\" + parent.id, data : stateEntered.donedata && stateEntered.donedata.call(this._scriptingContext, currentEvent)});\n            if(grandparent && grandparent.typeEnum === PARALLEL){\n                if(grandparent.states.every(s => this.isInFinalState(s) )){\n                    this._internalEventQueue.push({name : \"done.state.\" + grandparent.id});\n                }\n            }\n          }\n      }\n\n      return statesEntered;\n  }\n\n  _getEffectiveTargetStates(transition){\n    let targets = new Set();\n    for(let s of transition.targets){\n      if(s.typeEnum === HISTORY){\n        if(s.id in this._historyValue)\n          this._historyValue[s.id].forEach( state => targets.add(state))\n        else\n          [...this._getEffectiveTargetStates(s.transitions[0])].forEach( state => targets.add(state))\n      } else {\n        targets.add(s)\n      }\n    }\n    return targets\n  }\n\n  _computeEntrySet(transitions, statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    for(let t of transitions.iter()){\n      for(let s of t.targets){\n        this._addDescendantStatesToEnter(s,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n      }\n      let ancestor = t.scope;\n      for(let s of this._getEffectiveTargetStates(t)){\n        this._addAncestorStatesToEnter(s, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n      }\n    }\n  }\n\n  _computeExitSet(transitions) {\n    let statesToExit = new Set();\n    for(let t of transitions){\n      if(t.targets){\n        let scope = t.scope;\n        for(let s of this._getFullConfiguration()){\n          if(query.isDescendant(s,scope)) statesToExit.add(s);\n        }\n      }\n    }\n    return statesToExit; \n  }\n\n  _addAncestorStatesToEnter(state, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    let traverse = (anc) => {\n      if(anc.typeEnum === PARALLEL){\n        for(let child of anc.states){\n          if(child.typeEnum !== HISTORY && ![...statesToEnter].some(s => query.isDescendant(s, child))){\n            this._addDescendantStatesToEnter(child,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n          }\n        }\n      }\n    };\n    for(let anc of query.getAncestors(state,ancestor)){\n      statesToEnter.add(anc)\n      traverse(anc)\n    }\n    traverse(ancestor)\n  }\n\n\n  _addDescendantStatesToEnter(state,statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    if(state.typeEnum === HISTORY){\n      if(this._historyValue[state.id]){\n        for(let s of this._historyValue[state.id])\n          this._addDescendantStatesToEnter(s,statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n\n        for(let s of this._historyValue[state.id])\n          this._addAncestorStatesToEnter(s, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n      } else {\n        defaultHistoryContent[state.parent.id] = state.transitions[0]\n        for(let s of state.transitions[0].targets)\n          this._addDescendantStatesToEnter(s,statesToEnter,statesForDefaultEntry, defaultHistoryContent)\n\n        for(let s of state.transitions[0].targets)\n          this._addAncestorStatesToEnter(s, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n\n      }\n    } else {\n      statesToEnter.add(state)\n        if(state.typeEnum === COMPOSITE){\n          statesForDefaultEntry.add(state)\n          //for each state in initialRef, if it is an initial state, then add ancestors and descendants.\n          for(let s of state.initialRef){\n            let targets = s.typeEnum === INITIAL ? s.transitions[0].targets : [s]; \n            for(let targetState of targets){\n              this._addDescendantStatesToEnter(targetState,statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n            }\n          }\n          for(let s of state.initialRef){\n            let targets = s.typeEnum === INITIAL ? s.transitions[0].targets : [s]; \n            for(let targetState of targets){\n              this._addAncestorStatesToEnter(targetState, state, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n            }\n          }\n        }else{\n          if(state.typeEnum === PARALLEL){\n            for(let child of state.states){\n              if(child.typeEnum !== HISTORY && ![...statesToEnter].some(s => query.isDescendant(s, child))){\n                this._addDescendantStatesToEnter(child,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n              }\n            }\n          }\n        }\n    }\n  }\n\n  isInFinalState(s){\n      if(s.typeEnum === COMPOSITE){\n          return s.states.some(s => s.typeEnum === FINAL && this._configuration.contains(s));\n      }else if(s.typeEnum === PARALLEL){\n          return s.states.every(this.isInFinalState.bind(this))\n      }else{\n          return false\n      }\n  }\n\n  /** @private */\n  _evaluateAction(currentEvent, actionRef) {\n      try {\n        return actionRef.call(this._scriptingContext, currentEvent);     //SCXML system variables\n      } catch (e){\n        this._handleError(e, actionRef);\n      }\n  }\n\n  _handleError(e, actionRef){\n    let event = \n      e instanceof Error || (typeof e.__proto__.name === 'string' && e.__proto__.name.match(/^.*Error$/)) ?  //we can't just do 'e instanceof Error', because the Error object in the sandbox is from a different context, and instanceof will return false\n        {\n          name:'error.execution',\n          data : {\n            tagname: actionRef.tagname, \n            line: actionRef.line, \n            column: actionRef.column,\n            reason: e.message\n          },\n          type : 'platform'\n        } : \n        (e.name ? \n          e : \n          {\n            name:'error.execution',\n            data:e,\n            type : 'platform'\n          }\n        );\n    this._internalEventQueue.push(event);\n    this.emit('onError', event);\n  }\n\n  _log(){\n    if(printTrace){\n      var args = Array.from(arguments);\n      this.opts.console.log( \n        `${args[0]}: ${\n          args.slice(1).map(function(arg){\n            return arg === null ? 'null' : \n              ( arg === undefined ? 'undefined' : \n                ( typeof arg === 'string' ? arg : \n                  ( arg.toString() === '[object Object]' ? util.inspect(arg) : arg.toString())));\n\n          }).join(', ')\n        }\\n`\n      );\n    }\n  }\n\n  /**\n  * @interface Listener\n  */\n\n  /**\n  * @function\n  * @name Listener#onEntry \n  * @param {string} stateId\n  */\n\n  /**\n  * @function\n  * @name Listener#onExit \n  * @param {string} stateId\n  */\n\n  /**\n  * @function\n  * @name Listener#onTransition \n  * @param {string} sourceStateId Id of the source state\n  * @param {Array<string>} targetStatesIds Ids of the target states\n  * @param {number} transitionIndex Index of the transition relative to other transitions originating from source state.\n  */\n\n  /**\n  * @function\n  * @name Listener#onError\n  * @param {Error} errorInfo\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepBegin\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepResume\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepSuspend\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepEnd\n  */\n\n  /**\n  * @function\n  * @name Listener#onSmallStepBegin\n  * @param {string} event\n  */\n\n  /**\n  * @function\n  * @name Listener#onSmallStepEnd\n  */\n\n\n  /** \n  * Provides a generic mechanism to subscribe to state change and runtime\n  * error notifications.  Can be used for logging and debugging. For example,\n  * can attach a logger that simply logs the state changes.  Or can attach a\n  * network debugging client that sends state change notifications to a\n  * debugging server.\n  * This is an alternative interface to {@link EventEmitter.prototype#on}.\n  * @memberof BaseInterpreter.prototype \n  * @param {Listener} listener\n  */\n  registerListener(listener){\n      BaseInterpreter.EVENTS.forEach(function(event){\n        if(listener[event]) this.on(event,listener[event]);\n      }, this);\n  }\n\n  /** \n  * Unregister a Listener\n  * @memberof BaseInterpreter.prototype \n  * @param {Listener} listener\n  */\n  unregisterListener(listener){\n      BaseInterpreter.EVENTS.forEach(function(event){\n        if(listener[event]) this.off(event,listener[event]);\n      }, this);\n  }\n\n  /** \n  * Query the model to get all transition events.\n  * @return {Array<string>} Transition events.\n  * @memberof BaseInterpreter.prototype \n  */\n  getAllTransitionEvents(){\n      var events = {};\n      function getEvents(state){\n\n          if(state.transitions){\n              for (var txIdx = 0, txLen = state.transitions.length; txIdx < txLen; txIdx++) {\n                  events[state.transitions[txIdx].event] = true;\n              }\n          }\n\n          if(state.states) {\n              for (var stateIdx = 0, stateLen = state.states.length; stateIdx < stateLen; stateIdx++) {\n                  getEvents(state.states[stateIdx]);\n              }\n          }\n      }\n\n      getEvents(this._model);\n\n      return Object.keys(events);\n  }\n\n  /**\n  * Three things capture the current snapshot of a running SCION interpreter:\n  *\n  *      <ul>\n  *      <li> basic configuration (the set of basic states the state machine is in)</li>\n  *      <li> history state values (the states the state machine was in last time it was in the parent of a history state)</li>\n  *      <li> the datamodel</li>\n  *      </ul>\n  *      \n  * The snapshot object can be serialized as JSON and saved to a database. It can\n  * later be passed to the SCXML constructor to restore the state machine\n  * using the snapshot argument.\n  *\n  * @return {Snapshot} \n  * @memberof BaseInterpreter.prototype \n  */\n  getSnapshot(){\n    return [\n      this.getConfiguration(),\n      this._serializeHistory(),\n      this._isInFinalState,\n      this._model.$serializeDatamodel(),\n      this._internalEventQueue.slice()\n    ];\n  }\n\n  _serializeHistory(){\n    var o = {};\n    Object.keys(this._historyValue).forEach(function(sid){\n      o[sid] = this._historyValue[sid].map(function(state){return state.id});\n    },this);\n    return o;\n  }\n\n\n  /**\n   * @interface Event\n   */\n\n  /** \n  * @member name\n  * @memberof Event.prototype \n  * @type string\n  * @description The name of the event\n  */\n\n  /** \n  * @member data\n  * @memberof Event.prototype \n  * @type any\n  * @description The event data\n  */\n\n  /** \n  * An SCXML interpreter takes SCXML events as input, where an SCXML event is an\n  * object with \"name\" and \"data\" properties. These can be passed to method `gen`\n  * as two positional arguments, or as a single object.\n  * @param {string|Event} evtObjOrName\n  * @param {any=} optionalData\n  * @emits scion.BaseInterpreter#onEntry\n  * @emits scion.BaseInterpreter#onExit\n  * @emits scion.BaseInterpreter#onTransition\n  * @emits scion.BaseInterpreter#onDefaultEntry\n  * @emits scion.BaseInterpreter#onError\n  * @emits scion.BaseInterpreter#onBigStepBegin\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onBigStepSuspend\n  * @emits scion.BaseInterpreter#onBigStepResume\n  * @emits scion.BaseInterpreter#onSmallStepBegin\n  * @emits scion.BaseInterpreter#onSmallStepEnd\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onExitInterpreter\n  */\n  gen(evtObjOrName,optionalData) {\n    var currentEvent;\n    switch(typeof evtObjOrName){\n      case 'string':\n        currentEvent = {name : evtObjOrName, data : optionalData};\n        break;\n      case 'object':\n        if(typeof evtObjOrName.name === 'string'){\n          currentEvent = evtObjOrName;\n        }else{\n          throw new Error('Event object must have \"name\" property of type string.');\n        }\n        break;\n      default:\n        throw new Error('First argument to gen must be a string or object.');\n    }\n\n    if(this._isStepping) throw new Error('Cannot call gen during a big-step');\n\n    //otherwise, kick him off\n    this._isStepping = true;\n\n    this._performBigStep(currentEvent);\n\n    this._isStepping = false;\n    return this.getConfiguration();\n  }\n\n  /**\n  * Injects an external event into the interpreter asynchronously\n  * @param {Event}  currentEvent The event to inject\n  * @param {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n  * @emits scion.BaseInterpreter#onEntry\n  * @emits scion.BaseInterpreter#onExit\n  * @emits scion.BaseInterpreter#onTransition\n  * @emits scion.BaseInterpreter#onDefaultEntry\n  * @emits scion.BaseInterpreter#onError\n  * @emits scion.BaseInterpreter#onBigStepBegin\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onBigStepSuspend\n  * @emits scion.BaseInterpreter#onBigStepResume\n  * @emits scion.BaseInterpreter#onSmallStepBegin\n  * @emits scion.BaseInterpreter#onSmallStepEnd\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onExitInterpreter\n  */\n  genAsync(currentEvent, cb) {\n    if (currentEvent !== null && (typeof currentEvent !== 'object' || !currentEvent || typeof currentEvent.name !== 'string')) {\n      throw new Error('Expected currentEvent to be null or an Object with a name');\n    }\n    \n    if (typeof cb !== 'function') {\n      cb = nop;\n    }\n\n    this._externalEventQueue.push([currentEvent, cb]);\n\n    //the semantics we want are to return to the cb the results of processing that particular event.\n    function nextStep(e, c){\n      this._performBigStepAsync(e, function(err, config) {\n        c(err, config);\n\n        if(this._externalEventQueue.length){\n          nextStep.apply(this,this._externalEventQueue.shift());\n        }else{\n          this._isStepping = false;\n        }\n      }.bind(this));\n    }\n    if(!this._isStepping){ \n      this._isStepping = true;\n      nextStep.apply(this,this._externalEventQueue.shift());\n    }\n  }\n}\n\nBaseInterpreter.EVENTS = [\n  'onEntry',\n  'onExit',\n  'onTransition',\n  'onDefaultEntry',\n  'onError',\n  'onBigStepBegin',\n  'onBigStepSuspend',\n  'onBigStepResume',\n  'onSmallStepBegin',\n  'onSmallStepEnd',\n  'onBigStepEnd',\n  'onExitInterpreter'\n];\n\n//some global singletons to use to generate in-memory session ids, in case the user does not specify these data structures\nBaseInterpreter.sessionIdCounter = 1;\nBaseInterpreter.generateSessionid = function(){\n  return BaseInterpreter.sessionIdCounter++;\n}\nBaseInterpreter.sessionRegistry = new Map();\n\n// Do nothing\n\nfunction nop() {}\n\n\nclass InterpreterScriptingContext{\n  constructor(interpreter){ \n    this._interpreter = interpreter;\n    this._timeoutMap = {};\n    this._invokeMap = {};\n    this._timeouts = new Set()\n\n    //Regex from:\n    //  http://daringfireball.net/2010/07/improved_regex_for_matching_urls\n    //  http://stackoverflow.com/a/6927878\n    this.validateUriRegex = /(#_.*)|\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?]))/i;\n\n    this.invokeSendTargetRegex = /^#_(.*)$/;\n    this.scxmlSendTargetRegex = /^#_scxml_(.*)$/;\n  }\n\n\n  raise(event){\n    this._installDefaultPropsOnEvent(event, true);\n    this._interpreter._internalEventQueue.push(event); \n  }\n\n  parseXmlStringAsDOM(xmlString){\n    return (this._interpreter.opts.xmlParser || InterpreterScriptingContext.xmlParser).parse(xmlString);\n  }\n\n  invoke(invokeObj){\n    //look up invoker by type. assume invokers are passed in as an option to constructor\n    this._invokeMap[invokeObj.id] = new Promise((resolve, reject) => {\n      (this._interpreter.opts.invokers || InterpreterScriptingContext.invokers)[invokeObj.type](this._interpreter, invokeObj, this._interpreter.opts.invokerExecutionContext, (err, session) => {\n        if(err) return reject(err);\n\n        this._interpreter.emit('onInvokedSessionInitialized', session);\n        resolve(session);\n      });\n    });\n  }\n\n  cancelInvoke(invokeid){\n    //TODO: on cancel invoke clean up this._invokeMap\n    let sessionPromise = this._invokeMap[invokeid];\n    this._interpreter._log(`cancelling session with invokeid ${invokeid}`);\n    if(sessionPromise){\n      this._interpreter._log(`sessionPromise found`);\n      sessionPromise.then( \n        ((session) => {\n          this._interpreter._log(`resolved session ${invokeid}. cancelling... `);\n          session.cancel(); \n          //clean up\n          delete this._invokeMap[invokeid];\n        }), \n        ( (err) => {\n          //TODO: dispatch error back into the state machine as error.communication\n        }));\n    }\n  }\n\n  _installDefaultPropsOnEvent(event,isInternal){\n    if(!isInternal){ \n      event.origin = this._interpreter.opts._x._ioprocessors.scxml.location;     //TODO: preserve original origin when we autoforward? \n      event.origintype = event.type || SCXML_IOPROCESSOR_TYPE;\n    }\n    if(typeof event.type === 'undefined'){\n      event.type = isInternal ? 'internal' : 'external';\n    }\n    [\n      'name',\n      'sendid',\n      'invokeid',\n      'data',\n      'origin',\n      'origintype'\n    ].forEach(prop => {\n      if(typeof event[prop] === 'undefined'){\n        event[prop] = undefined;\n      }\n    });\n  }\n\n  send(event, options){\n    this._interpreter._log('send event', event, options);\n    options = options || {};\n    var sendType = options.type || SCXML_IOPROCESSOR_TYPE;\n    //TODO: move these out\n    function validateSend(event, options, sendAction){\n      if(event.target){\n        var targetIsValidUri = this.validateUriRegex.test(event.target)\n        if(!targetIsValidUri){\n          throw { name : \"error.execution\", data: 'Target is not valid URI', sendid: event.sendid, type : 'platform' };\n        }\n      }\n      if( sendType !== SCXML_IOPROCESSOR_TYPE) {  //TODO: extend this to support HTTP, and other IO processors\n        throw { name : \"error.execution\", data: 'Unsupported event processor type', sendid: event.sendid, type : 'platform' };\n      }\n\n      sendAction.call(this, event, options);\n    }\n\n    function defaultSendAction (event, options) {\n\n      if( typeof setTimeout === 'undefined' ) throw new Error('Default implementation of BaseInterpreter.prototype.send will not work unless setTimeout is defined globally.');\n\n      var match;\n      if(event.target === '#_internal'){\n        this.raise(event);\n      }else{ \n        this._installDefaultPropsOnEvent(event, false);\n        event.origintype = SCXML_IOPROCESSOR_TYPE;      //TODO: extend this to support HTTP, and other IO processors\n                                                        //TODO : paramterize this based on send/@type?\n        if(!event.target){\n          doSend.call(this, this._interpreter);\n        }else if(event.target === '#_parent'){\n          if(this._interpreter.opts.parentSession){\n            event.invokeid = this._interpreter.opts.invokeid;\n            doSend.call(this, this._interpreter.opts.parentSession);\n          }else{\n            throw { name : \"error.communication\", data: 'Parent session not specified', sendid: event.sendid, type : 'platform' };\n          }\n        } else if(match = event.target.match(this.scxmlSendTargetRegex)){\n          let targetSessionId = match[1];\n          let session = this._interpreter.opts.sessionRegistry.get(targetSessionId)\n          if(session){\n            doSend.call(this,session);\n          }else {\n            throw {name : 'error.communication', sendid: event.sendid, type : 'platform'};\n          }\n        }else if(match = event.target.match(this.invokeSendTargetRegex)){\n          //TODO: test this code path.\n          var invokeId = match[1]\n          this._invokeMap[invokeId].then( (session) => {\n            doSend.call(this,session);\n          })\n        } else {\n          throw new Error('Unrecognized send target.'); //TODO: dispatch error back into the state machine\n        }\n      }\n\n      function doSend(session){\n        //TODO: we probably now need to refactor data structures:\n        //    this._timeouts\n        //    this._timeoutMap\n        var timeoutHandle = setTimeout(function(){\n          if (event.sendid) delete this._timeoutMap[event.sendid];\n          this._timeouts.delete(timeoutOptions);\n          if(this._interpreter.opts.doSend){\n            this._interpreter.opts.doSend(session, event);\n          }else{\n            session[this._interpreter.opts.sendAsync ? 'genAsync' : 'gen'](event);\n          }\n        }.bind(this), options.delay || 0);\n\n        var timeoutOptions = {\n          sendOptions : options,\n          timeoutHandle : timeoutHandle\n        };\n        if (event.sendid) this._timeoutMap[event.sendid] = timeoutHandle;\n        this._timeouts.add(timeoutOptions); \n      }\n    }\n\n    function publish(){\n      this._interpreter.emit(event.name,event.data);\n    }\n\n    //choose send function\n    //TODO: rethink how this custom send works\n    var sendFn;         \n    if(event.type === 'https://github.com/jbeard4/SCION#publish'){\n      sendFn = publish;\n    }else if(this._interpreter.opts.customSend){\n      sendFn = this._interpreter.opts.customSend;\n    }else{\n      sendFn = defaultSendAction;\n    }\n\n    options=options || {};\n\n    this._interpreter._log(\"sending event\", event.name, \"with content\", event.data, \"after delay\", options.delay);\n\n    validateSend.call(this, event, options, sendFn);\n  }\n\n  cancel(sendid){\n    if(this._interpreter.opts.customCancel) {\n      return this._interpreter.opts.customCancel.apply(this, [sendid]);\n    }\n\n    if( typeof clearTimeout === 'undefined' ) throw new Error('Default implementation of BaseInterpreter.prototype.cancel will not work unless setTimeout is defined globally.');\n\n    if (sendid in this._timeoutMap) {\n      this._interpreter._log(\"cancelling \", sendid, \" with timeout id \", this._timeoutMap[sendid]);\n      clearTimeout(this._timeoutMap[sendid]);\n    }\n  }\n}\n\nmodule.exports = extend(new EventEmitter, {\n    BaseInterpreter: BaseInterpreter,\n    ArraySet : ArraySet,\n    STATE_TYPES : constants.STATE_TYPES,\n    initializeModel : initializeModel,\n    InterpreterScriptingContext : InterpreterScriptingContext,\n    helpers: helpers,\n    query: query\n});\n","function EventEmitter() {\n    this._listeners = {};\n}\n\nEventEmitter.prototype.on = function _on(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        this._listeners[type] = [];\n    }\n\n    if (this._listeners[type].indexOf(listener) === -1) {\n        this._listeners[type].push(listener);\n    }\n\n    return this;\n};\n\nEventEmitter.prototype.once = function _once(type, listener) {\n    var self = this;\n\n    function __once() {\n        for (var args = [], i = 0; i < arguments.length; i += 1) {\n            args[i] = arguments[i];\n        }\n\n        self.off(type, __once);\n        listener.apply(self, args);\n    }\n\n    __once.listener = listener;\n\n    return this.on(type, __once);\n};\n\nEventEmitter.prototype.off = function _off(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    if (typeof listener === 'undefined') {\n        this._listeners[type] = [];\n        return this;\n    }\n\n    var index = this._listeners[type].indexOf(listener);\n\n    if (index === -1) {\n        for (var i = 0; i < this._listeners[type].length; i += 1) {\n            if (this._listeners[type][i].listener === listener) {\n                index = i;\n                break;\n            }\n        }\n    }\n\n    this._listeners[type].splice(index, 1);\n    return this;\n};\n\nEventEmitter.prototype.emit = function _emit(type) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    for (var args = [], i = 1; i < arguments.length; i += 1) {\n        args[i - 1] = arguments[i];\n    }\n\n    this._listeners[type].forEach(function __emit(listener) {\n        listener.apply(this, args);\n    }, this);\n\n    return this;\n};\n\nmodule.exports.EventEmitter = EventEmitter;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors ||\n  function getOwnPropertyDescriptors(obj) {\n    var keys = Object.keys(obj);\n    var descriptors = {};\n    for (var i = 0; i < keys.length; i++) {\n      descriptors[keys[i]] = Object.getOwnPropertyDescriptor(obj, keys[i]);\n    }\n    return descriptors;\n  };\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  if (typeof process !== 'undefined' && process.noDeprecation === true) {\n    return fn;\n  }\n\n  // Allow for deprecating things in the process of starting up.\n  if (typeof process === 'undefined') {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nvar kCustomPromisifiedSymbol = typeof Symbol !== 'undefined' ? Symbol('util.promisify.custom') : undefined;\n\nexports.promisify = function promisify(original) {\n  if (typeof original !== 'function')\n    throw new TypeError('The \"original\" argument must be of type Function');\n\n  if (kCustomPromisifiedSymbol && original[kCustomPromisifiedSymbol]) {\n    var fn = original[kCustomPromisifiedSymbol];\n    if (typeof fn !== 'function') {\n      throw new TypeError('The \"util.promisify.custom\" argument must be of type Function');\n    }\n    Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n      value: fn, enumerable: false, writable: false, configurable: true\n    });\n    return fn;\n  }\n\n  function fn() {\n    var promiseResolve, promiseReject;\n    var promise = new Promise(function (resolve, reject) {\n      promiseResolve = resolve;\n      promiseReject = reject;\n    });\n\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    args.push(function (err, value) {\n      if (err) {\n        promiseReject(err);\n      } else {\n        promiseResolve(value);\n      }\n    });\n\n    try {\n      original.apply(this, args);\n    } catch (err) {\n      promiseReject(err);\n    }\n\n    return promise;\n  }\n\n  Object.setPrototypeOf(fn, Object.getPrototypeOf(original));\n\n  if (kCustomPromisifiedSymbol) Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n    value: fn, enumerable: false, writable: false, configurable: true\n  });\n  return Object.defineProperties(\n    fn,\n    getOwnPropertyDescriptors(original)\n  );\n}\n\nexports.promisify.custom = kCustomPromisifiedSymbol\n\nfunction callbackifyOnRejected(reason, cb) {\n  // `!reason` guard inspired by bluebird (Ref: https://goo.gl/t5IS6M).\n  // Because `null` is a special error value in callbacks which means \"no error\n  // occurred\", we error-wrap so the callback consumer can distinguish between\n  // \"the promise rejected with null\" or \"the promise fulfilled with undefined\".\n  if (!reason) {\n    var newReason = new Error('Promise was rejected with a falsy value');\n    newReason.reason = reason;\n    reason = newReason;\n  }\n  return cb(reason);\n}\n\nfunction callbackify(original) {\n  if (typeof original !== 'function') {\n    throw new TypeError('The \"original\" argument must be of type Function');\n  }\n\n  // We DO NOT return the promise as it gives the user a false sense that\n  // the promise is actually somehow related to the callback's execution\n  // and that the callback throwing will reject the promise.\n  function callbackified() {\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n\n    var maybeCb = args.pop();\n    if (typeof maybeCb !== 'function') {\n      throw new TypeError('The last argument must be of type Function');\n    }\n    var self = this;\n    var cb = function() {\n      return maybeCb.apply(self, arguments);\n    };\n    // In true node style we process the callback on `nextTick` with all the\n    // implications (stack, `uncaughtException`, `async_hooks`)\n    original.apply(this, args)\n      .then(function(ret) { process.nextTick(cb, null, ret) },\n            function(rej) { process.nextTick(callbackifyOnRejected, rej, cb) });\n  }\n\n  Object.setPrototypeOf(callbackified, Object.getPrototypeOf(original));\n  Object.defineProperties(callbackified,\n                          getOwnPropertyDescriptors(original));\n  return callbackified;\n}\nexports.callbackify = callbackify;\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","/* begin ArraySet */\n\n/** @constructor */\nfunction ArraySet(l) {\n    l = l || [];\n    this.o = new Set(l);        \n}\n\nArraySet.prototype = {\n\n    add : function(x) {\n        this.o.add(x);\n    },\n\n    remove : function(x) {\n        return this.o.delete(x);\n    },\n\n    union : function(l) {\n        for (var v of l.o) {\n            this.o.add(v);\n        }\n        return this;\n    },\n\n    difference : function(l) {\n        for (var v of l.o) {\n            this.o.delete(v);\n        }\n        return this;\n    },\n\n    contains : function(x) {\n        return this.o.has(x);\n    },\n\n    iter : function() {\n        return Array.from(this.o);\n    },\n\n    isEmpty : function() {\n        return !this.o.size;\n    },\n\n    size: function() {\n        return this.o.size;\n    },\n\n    equals : function(s2) {\n        if (this.o.size !== s2.size()) {\n            return false;\n        }\n\n        for (var v of this.o) {\n            if (!s2.contains(v)) {\n                return false;\n            }\n        }\n\n        return true;\n    },\n\n    toString : function() {\n        return this.o.size === 0 ? '<empty>' : Array.from(this.o).join(',\\n');\n    }\n};\n\nmodule.exports = ArraySet;\n","const constants = require('./constants'),\n      STATE_TYPES = constants.STATE_TYPES,\n      RX_TRAILING_WILDCARD = constants.RX_TRAILING_WILDCARD;\n\nconst printTrace = false;\n\nmodule.exports = {\n  extend : extend,\n  transitionWithTargets : transitionWithTargets,\n  transitionComparator : transitionComparator,\n  initializeModel : initializeModel,\n  isEventPrefixMatch : isEventPrefixMatch,\n  isTransitionMatch : isTransitionMatch,\n  scxmlPrefixTransitionSelector : scxmlPrefixTransitionSelector,\n  eventlessTransitionSelector : eventlessTransitionSelector,\n  getTransitionWithHigherSourceChildPriority : getTransitionWithHigherSourceChildPriority,\n  sortInEntryOrder : sortInEntryOrder,\n  getStateWithHigherSourceChildPriority : getStateWithHigherSourceChildPriority,\n  initializeModelGeneratorFn : initializeModelGeneratorFn,\n  deserializeSerializedConfiguration : deserializeSerializedConfiguration,\n  deserializeHistory : deserializeHistory\n};\n\nfunction extend (to, from){\n  Object.keys(from).forEach(function(k){\n    to[k] = from[k]; \n  });\n  return to;\n};\n\nfunction transitionWithTargets(t){\n    return t.targets;\n}\n\nfunction transitionComparator(t1, t2) {\n    return t1.documentOrder - t2.documentOrder;\n}\n\nfunction initializeModel(rootState, opts){\n    var transitions = [], idToStateMap = new Map(), documentOrder = 0;\n\n\n    //TODO: need to add fake ids to anyone that doesn't have them\n    //FIXME: make this safer - break into multiple passes\n    var idCount = {};\n\n    function generateId(type){\n        if(idCount[type] === undefined) idCount[type] = 0;\n\n        do {\n          var count = idCount[type]++;\n          var id = '$generated-' + type + '-' + count; \n        } while (idToStateMap.has(id))\n        \n        return id;\n    }\n\n    function wrapInFakeRootState(state){\n        return {\n            $deserializeDatamodel : state.$deserializeDatamodel || function(){},\n            $serializeDatamodel : state.$serializeDatamodel || function(){ return null;},\n            $idToStateMap : idToStateMap,   //keep this for handy deserialization of serialized configuration\n            docUrl : state.docUrl,\n            name : state.name,\n            states : [\n                {\n                    $type : 'initial',\n                    transitions : [{\n                        target : state\n                    }]\n                },\n                state\n            ]\n        };\n    }\n\n    var statesWithInitialAttributes = [];\n\n    /**\n      @this {SCTransition}\n    */\n    function transitionToString(sourceState){\n      return `${sourceState} -- ${this.events ? '(' + this.events.join(',') + ')' : null}${this.cond ? '[' + this.cond.name + ']' : ''} --> ${this.targets ? this.targets.join(',') : null}`;\n    }\n\n    /**\n      @this {SCState}\n    */\n    function stateToString(){\n      return this.id;\n    }\n\n    function populateStateIdMap(state){\n      //populate state id map\n      if(state.id){\n          idToStateMap.set(state.id, state);\n      }\n\n      if(state.states) {\n          for (var j = 0, len = state.states.length; j < len; j++) {\n              populateStateIdMap(state.states[j]);\n          }\n      }\n    }\n\n    function traverse(ancestors,state){\n\n        if(printTrace) state.toString = stateToString;\n\n        //add to global transition and state id caches\n        if(state.transitions) transitions.push.apply(transitions,state.transitions);\n\n        //create a default type, just to normalize things\n        //this way we can check for unsupported types below\n        state.$type = state.$type || 'state';\n\n        //add ancestors and depth properties\n        state.ancestors = ancestors;\n        state.depth = ancestors.length;\n        state.parent = ancestors[0];\n        state.documentOrder = documentOrder++; \n\n        //add some information to transitions\n        state.transitions = state.transitions || [];\n        for (var j = 0, len = state.transitions.length; j < len; j++) {\n            var transition = state.transitions[j];\n            transition.documentOrder = documentOrder++; \n            transition.source = state;\n            if(printTrace) transition.toString = transitionToString.bind(transition, state);\n        };\n\n        //recursive step\n        if(state.states) {\n            var ancs = [state].concat(ancestors);\n            for (var j = 0, len = state.states.length; j < len; j++) {\n                traverse(ancs, state.states[j]);\n            }\n        }\n\n        //setup fast state type\n        switch(state.$type){\n            case 'parallel':\n                state.typeEnum = STATE_TYPES.PARALLEL;\n                state.isAtomic = false;\n                break;\n            case 'initial' : \n                state.typeEnum = STATE_TYPES.INITIAL;\n                state.isAtomic = true;\n                break;\n            case 'history' :\n                state.typeEnum = STATE_TYPES.HISTORY;\n                state.isAtomic = true;\n                break;\n            case 'final' : \n                state.typeEnum = STATE_TYPES.FINAL;\n                state.isAtomic = true;\n                break;\n            case 'state' : \n            case 'scxml' :\n                if(state.states && state.states.length){\n                    state.typeEnum = STATE_TYPES.COMPOSITE;\n                    state.isAtomic = false;\n                }else{\n                    state.typeEnum = STATE_TYPES.BASIC;\n                    state.isAtomic = true;\n                }\n                break;\n            default :\n                throw new Error('Unknown state type: ' + state.$type);\n        }\n\n        //descendants property on states will now be populated. add descendants to this state\n        if(state.states){\n            state.descendants = state.states.concat(state.states.map(function(s){return s.descendants;}).reduce(function(a,b){return a.concat(b);},[]));\n        }else{\n            state.descendants = [];\n        }\n\n        var initialChildren;\n        if(state.typeEnum === STATE_TYPES.COMPOSITE){\n            //set up initial state\n            \n            if(Array.isArray(state.initial) || typeof state.initial === 'string'){\n                statesWithInitialAttributes.push(state);\n            }else{\n                //take the first child that has initial type, or first child\n                initialChildren = state.states.filter(function(child){\n                    return child.$type === 'initial';\n                });\n\n                state.initialRef = [initialChildren.length ? initialChildren[0] : state.states[0]];\n                checkInitialRef(state);\n            }\n\n        }\n\n        //hook up history\n        if(state.typeEnum === STATE_TYPES.COMPOSITE ||\n                state.typeEnum === STATE_TYPES.PARALLEL){\n\n            var historyChildren = state.states.filter(function(s){\n                return s.$type === 'history';\n            }); \n\n           state.historyRef = historyChildren;\n        }\n\n        //now it's safe to fill in fake state ids\n        if(!state.id){\n            state.id = generateId(state.$type);\n            idToStateMap.set(state.id, state);\n        }\n\n        //normalize onEntry/onExit, which can be single fn or array, or array of arrays (blocks)\n        ['onEntry','onExit'].forEach(function(prop){\n          if (state[prop]) {\n            if(!Array.isArray(state[prop])){\n              state[prop] = [state[prop]];\n            }\n            if(!state[prop].every(function(handler){ return Array.isArray(handler); })){\n              state[prop] = [state[prop]];\n            }\n          }\n        });\n\n        if (state.invokes && !Array.isArray(state.invokes)) {\n            state.invokes = [state.invokes];\n            state.invokes.forEach( invoke => {\n              if (invoke.finalize && !Array.isArray(invoke.finalize)) {\n                invoke.finalize = [invoke.finalize];\n              }\n            })\n        }\n    }\n\n    //TODO: convert events to regular expressions in advance\n\n    function checkInitialRef(state){\n      if(!state.initialRef) throw new Error('Unable to locate initial state for composite state: ' + state.id);\n    }\n    function connectIntialAttributes(){\n      for (var j = 0, len = statesWithInitialAttributes.length; j < len; j++) {\n        var s = statesWithInitialAttributes[j];\n\n        var initialStates = Array.isArray(s.initial) ? s.initial : [s.initial];\n        s.initialRef = initialStates.map(function(initialState){ return idToStateMap.get(initialState); });\n        checkInitialRef(s);\n      }\n    }\n\n    var RX_WHITESPACE = /\\s+/;\n\n    function connectTransitionGraph(){\n        //normalize as with onEntry/onExit\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if (t.onTransition && !Array.isArray(t.onTransition)) {\n                t.onTransition = [t.onTransition];\n            }\n\n            //normalize \"event\" attribute into \"events\" attribute\n            if (typeof t.event === 'string') {\n                t.events = t.event.trim().split(RX_WHITESPACE);\n            }\n            delete t.event;\n\n            if(t.targets || (typeof t.target === 'undefined')) {\n                //targets have already been set up\n                continue;\n            }   \n\n            if(typeof t.target === 'string'){\n                var target = idToStateMap.get(t.target);\n                if(!target) throw new Error('Unable to find target state with id ' + t.target);\n                t.target = target;\n                t.targets = [t.target];\n            }else if(Array.isArray(t.target)){\n                t.targets = t.target.map(function(target){\n                    if(typeof target === 'string'){\n                        target = idToStateMap.get(target);\n                        if(!target) throw new Error('Unable to find target state with id ' + t.target);\n                        return target;\n                    }else{\n                        return target;\n                    } \n                }); \n            }else if(typeof t.target === 'object'){\n                t.targets = [t.target];\n            }else{\n                throw new Error('Transition target has unknown type: ' + t.target);\n            }\n        }\n\n        //hook up LCA - optimization\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if(t.targets) t.lcca = getLCCA(t.source,t.targets[0]);    //FIXME: we technically do not need to hang onto the lcca. only the scope is used by the algorithm\n\n            t.scope = getScope(t);\n        }\n    }\n\n    function getScope(transition){\n        //Transition scope is normally the least common compound ancestor (lcca).\n        //Internal transitions have a scope equal to the source state.\n        var transitionIsReallyInternal = \n                transition.type === 'internal' &&\n                  transition.source.typeEnum === STATE_TYPES.COMPOSITE &&   //is transition source a composite state\n                  transition.source.parent &&    //root state won't have parent\n                  transition.targets && //does it target its descendants\n                  transition.targets.every(\n                      function(target){ return transition.source.descendants.indexOf(target) > -1;});\n\n        if(!transition.targets){\n            return null;\n        }else if(transitionIsReallyInternal){\n            return transition.source; \n        }else{\n            return transition.lcca;\n        }\n    }\n\n    function getLCCA(s1, s2) {\n        var commonAncestors = [];\n        for (var j = 0, len = s1.ancestors.length; j < len; j++) {\n            var anc = s1.ancestors[j];\n            if(\n                (\n                  opts && opts.legacySemantics ? \n                    anc.typeEnum === STATE_TYPES.COMPOSITE :\n                    (anc.typeEnum === STATE_TYPES.COMPOSITE || anc.typeEnum === STATE_TYPES.PARALLEL) \n                ) &&\n                anc.descendants.indexOf(s2) > -1){\n\n                commonAncestors.push(anc);\n            }\n        };\n        if(!commonAncestors.length) throw new Error(\"Could not find LCA for states.\");\n        return commonAncestors[0];\n    }\n\n    //main execution starts here\n    //FIXME: only wrap in root state if it's not a compound state\n    populateStateIdMap(rootState);\n    var fakeRootState = wrapInFakeRootState(rootState);  //I wish we had pointer semantics and could make this a C-style \"out argument\". Instead we return him\n    traverse([],fakeRootState);\n    connectTransitionGraph();\n    connectIntialAttributes();\n\n    return fakeRootState;\n}\n\n\nfunction isEventPrefixMatch(prefix, fullName) {\n    prefix = prefix.replace(RX_TRAILING_WILDCARD, '');\n\n    if (prefix === fullName) {\n        return true;\n    }\n\n    if (prefix.length > fullName.length) {\n        return false;\n    }\n\n    if (fullName.charAt(prefix.length) !== '.') {\n        return false;\n    }\n\n    return (fullName.indexOf(prefix) === 0);\n}\n\nfunction isTransitionMatch(t, eventName) {\n    return t.events.some((tEvent) => {\n        return tEvent === '*' || isEventPrefixMatch(tEvent, eventName);\n    });\n}\n\nfunction scxmlPrefixTransitionSelector(t, event, evaluator, selectEventlessTransitions) {\n    return ( \n      selectEventlessTransitions ? \n        !t.events :\n        (t.events && event && event.name && isTransitionMatch(t, event.name))\n      )\n      && (!t.cond || evaluator(t.cond));\n}\n\nfunction eventlessTransitionSelector(state){\n  return state.transitions.filter(function(transition){ return !transition.events || ( transition.events && transition.events.length === 0 ); });\n}\n\n//priority comparison functions\nfunction getTransitionWithHigherSourceChildPriority(_args) {\n    let t1 = _args[0], t2 = _args[1];\n    var r = getStateWithHigherSourceChildPriority(t1.source, t2.source);\n    //compare transitions based first on depth, then based on document order\n    if (t1.source.depth < t2.source.depth) {\n        return t2;\n    } else if (t2.source.depth < t1.source.depth) {\n        return t1;\n    } else {\n       if (t1.documentOrder < t2.documentOrder) {\n            return t1;\n        } else {\n            return t2;\n        }\n    }\n}\n\nfunction sortInEntryOrder(s1, s2){\n  return getStateWithHigherSourceChildPriority(s1, s2) * -1\n}\n\nfunction getStateWithHigherSourceChildPriority(s1, s2) {\n    //compare states based first on depth, then based on document order\n    if (s1.depth > s2.depth) {\n        return -1;\n    } else if (s1.depth < s2.depth) {\n        return 1;\n    } else {\n        //Equality\n        if (s1.documentOrder < s2.documentOrder) {\n            return 1;\n        } else if (s1.documentOrder > s2.documentOrder) {\n            return -1;\n        } else{\n            return 0;\n        }\n    }\n}\n\nfunction initializeModelGeneratorFn(modelFn, opts, interpreter){\n    return modelFn.call(interpreter,\n        opts._x,\n        opts._x._sessionid,\n        opts._x._ioprocessors,\n        interpreter.isIn.bind(interpreter));\n}\n\nfunction deserializeSerializedConfiguration(serializedConfiguration,idToStateMap){\n  return serializedConfiguration.map(function(id){\n    var state = idToStateMap.get(id);\n    if(!state) throw new Error('Error loading serialized configuration. Unable to locate state with id ' + id);\n    return state;\n  });\n}\n\nfunction deserializeHistory(serializedHistory,idToStateMap){\n  var o = {};\n  Object.keys(serializedHistory).forEach(function(sid){\n    o[sid] = serializedHistory[sid].map(function(id){\n      var state = idToStateMap.get(id);\n      if(!state) throw new Error('Error loading serialized history. Unable to locate state with id ' + id);\n      return state;\n    });\n  });\n  return o;\n}\n\n","const constants = require('./constants');\n\n//model accessor functions\nconst query = {\n    isDescendant : function(s1, s2){\n      //Returns 'true' if state1 is a descendant of state2 (a child, or a child of a child, or a child of a child of a child, etc.) Otherwise returns 'false'.\n      return s2.descendants.indexOf(s1) > -1;\n    },\n    getAncestors: function(s, root) {\n        var ancestors, index, state;\n        index = s.ancestors.indexOf(root);\n        if (index > -1) {\n            return s.ancestors.slice(0, index);\n        } else {\n            return s.ancestors;\n        }\n    },\n    isOrthogonalTo: function(s1, s2) {\n        //Two control states are orthogonal if they are not ancestrally\n        //related, and their smallest, mutual parent is a Concurrent-state.\n        return !this.isAncestrallyRelatedTo(s1, s2) && this.getLCA(s1, s2).typeEnum === constants.STATE_TYPES.PARALLEL;\n    },\n    isAncestrallyRelatedTo: function(s1, s2) {\n        //Two control states are ancestrally related if one is child/grandchild of another.\n        return this.getAncestorsOrSelf(s2).indexOf(s1) > -1 || this.getAncestorsOrSelf(s1).indexOf(s2) > -1;\n    },\n    getAncestorsOrSelf: function(s, root) {\n        return [s].concat(query.getAncestors(s, root));\n    },\n    getDescendantsOrSelf: function(s) {\n        return [s].concat(s.descendants);\n    },\n    getLCA: function(s1, s2) {\n        var commonAncestors = this.getAncestors(s1).filter(function(a){\n            return a.descendants.indexOf(s2) > -1;\n        },this);\n        return commonAncestors[0];\n    }\n};\n\nmodule.exports = query;\n"],"sourceRoot":""}